(function(){"use strict";const Kt=["selfBuffs","groupBuffs","squadBuffs"],Gt=o=>o!=null&&o.classification?o.classification==="Boon":!0,yt=o=>`b${o}`,Bn=(o,a)=>{const l=Array.isArray(o==null?void 0:o.activeTimes)?o.activeTimes:[],M=typeof l[0]=="number"?l[0]:0;return M>0?M:a},Yt=(o,a,l,M,x,_,fe)=>{const Q=o==="selfBuffs"?1:Math.max(o==="groupBuffs"?_-1:fe-1,0);return!Q||!x?{generationMs:0,wastedMs:0}:a?{generationMs:l*x*Q,wastedMs:M*x*Q}:{generationMs:l/100*x*Q,wastedMs:M/100*x*Q}},In=o=>{const a=new Map,l=new Map;return o.forEach(_=>{const fe=_.details;if(!fe)return;const Q=fe.durationMS||0,ge=fe.buffMap||{};Object.entries(ge).forEach(([U,W])=>{if(!a.has(U)){a.set(U,W);return}const pe=a.get(U)||{},E={name:pe.name||W.name,stacking:pe.stacking??W.stacking,icon:pe.icon||W.icon,classification:pe.classification||W.classification};a.set(U,E)});const Ve=(fe.players||[]).filter(U=>!U.notInSquad),Ce=Ve.length,he=new Map;Ve.forEach(U=>{const W=U.group??0;he.set(W,(he.get(W)||0)+1)}),Ve.forEach(U=>{const W=U.account||U.name||U.character_name||"Unknown",pe=U.profession||"Unknown",E=U.group??0,oe=he.get(E)||1,se=Bn(U,Q);l.has(W)||l.set(W,{account:W,profession:pe,professions:new Set,professionTimeMs:{},activeTimeMs:0,numFights:0,groupSupported:0,squadSupported:0,boons:{}});const ae=l.get(W);ae.profession=pe,pe!=="Unknown"&&(ae.professions.add(pe),ae.professionTimeMs[pe]=(ae.professionTimeMs[pe]||0)+se),ae.activeTimeMs+=se,ae.numFights+=1,ae.groupSupported+=oe,ae.squadSupported+=Ce,Kt.forEach(Se=>{(U[Se]||[]).forEach(le=>{var Ie,xe,Fe,Ze;if(typeof(le==null?void 0:le.id)!="number")return;const Ue=yt(le.id),Be=ge[Ue];if(!Gt(Be))return;const Ae=(Be==null?void 0:Be.stacking)??!1,qe=((xe=(Ie=le.buffData)==null?void 0:Ie[0])==null?void 0:xe.generation)??0,De=((Ze=(Fe=le.buffData)==null?void 0:Fe[0])==null?void 0:Ze.wasted)??0,{generationMs:Me,wastedMs:je}=Yt(Se,Ae,qe,De,Q,oe,Ce);!Me&&!je||(a.has(Ue)||a.set(Ue,Be||{}),ae.boons[Ue]||(ae.boons[Ue]={selfBuffs:{generationMs:0,wastedMs:0},groupBuffs:{generationMs:0,wastedMs:0},squadBuffs:{generationMs:0,wastedMs:0}}),ae.boons[Ue][Se].generationMs+=Me,ae.boons[Ue][Se].wastedMs+=je)})})})}),{boonTables:Array.from(a.keys()).filter(_=>Gt(a.get(_))).map(_=>{const fe=a.get(_)||{},Q=[];return l.forEach(ge=>{var U;const Re=ge.boons[_];if(!Re||!Kt.some(W=>Re[W].generationMs>0||Re[W].wastedMs>0))return;const Ce=Array.from(ge.professions||[]).filter(W=>W&&W!=="Unknown");let he=ge.profession;if(Ce.length>0){he=Ce[0];let W=((U=ge.professionTimeMs)==null?void 0:U[he])||0;Ce.forEach(pe=>{var oe;const E=((oe=ge.professionTimeMs)==null?void 0:oe[pe])||0;E>W&&(W=E,he=pe)})}Q.push({account:ge.account,profession:he||"Unknown",professionList:Ce,activeTimeMs:ge.activeTimeMs||1,numFights:ge.numFights||1,groupSupported:ge.groupSupported||1,squadSupported:ge.squadSupported||1,categories:{selfBuffs:{...Re.selfBuffs},groupBuffs:{...Re.groupBuffs},squadBuffs:{...Re.squadBuffs}}})}),{id:_,name:fe.name||_,icon:fe.icon,stacking:fe.stacking??!1,rows:Q}}).filter(_=>_.rows.length>0)}},Jt=(o,a,l,M,x,_,fe={})=>{var U,W,pe,E;const ge=((o==null?void 0:o[a])||[]).find(oe=>oe.id===l);if(!ge)return{generationMs:0,wastedMs:0};const Re=fe[yt(l)],Ve=(Re==null?void 0:Re.stacking)??!1,Ce=((W=(U=ge.buffData)==null?void 0:U[0])==null?void 0:W.generation)??0,he=((E=(pe=ge.buffData)==null?void 0:pe[0])==null?void 0:E.wasted)??0;return Yt(a,Ve,Ce,he,M,x,_)};var Pn={methods:{tiered:{tiers:{shortMs:500,mediumMs:1500,weights:{short:.5,medium:1,long:2}}}}};const Hn=Pn,Lt="count",Un=o=>(o||0)/1e3,Ln=(o,a)=>{var x;if(!o)return 0;const l=(x=Hn.methods.tiered)==null?void 0:x.tiers;if(!l)return o;const M=a/Math.max(o,1);return M<=l.shortMs?o*l.weights.short:M<=l.mediumMs?o*l.weights.medium:o*l.weights.long},Qt=(o,a,l)=>l==="duration"?Un(a):l==="tiered"?Ln(o,a):o;function $n(o,a=Lt){var _;const l=(_=o.statsAll)==null?void 0:_[0],M=Number((l==null?void 0:l.appliedCrowdControl)??0),x=Number((l==null?void 0:l.appliedCrowdControlDuration)??0);return Qt(M,x,a)}function xn(o,a){const l=(a==null?void 0:a.durationMS)||0,M=(a==null?void 0:a.buffMap)||{},x=o.filter(Q=>!Q.notInSquad),_=x.length,fe=new Map;x.forEach(Q=>{const ge=Q.group??0;fe.set(ge,(fe.get(ge)||0)+1)}),x.forEach(Q=>{const ge=fe.get(Q.group??0)||1,Re=Jt(Q,"selfBuffs",1122,l,ge,_,M),Ve=Jt(Q,"squadBuffs",1122,l,ge,_,M);Q.stabGeneration=(Re.generationMs+Ve.generationMs)/1e3})}function On(o){if(!o.statsTargets)return 0;let a=0;for(const l of o.statsTargets)l&&l.length>0&&(a+=l[0].downContribution||0);return a}function Rn(o){if(!o.extBarrierStats||!o.extBarrierStats.outgoingBarrierAllies)return 0;let a=0;for(const l of o.extBarrierStats.outgoingBarrierAllies)if(l)for(const M of l)M&&(a+=M.barrier||0);return a}function _n(o){if(!o.extHealingStats||!o.extHealingStats.outgoingHealingAllies)return 0;let a=0;for(const l of o.extHealingStats.outgoingHealingAllies)if(l)for(const M of l)M&&(a+=M.healing||0);return a}const qn=o=>{var a,l,M,x;return(((l=(a=o.support)==null?void 0:a[0])==null?void 0:l.condiCleanse)||0)+(((x=(M=o.support)==null?void 0:M[0])==null?void 0:x.condiCleanseSelf)||0)},jn=(o,a=Lt)=>{var _;const l=(_=o.support)==null?void 0:_[0],M=Number((l==null?void 0:l.boonStrips)??0),x=Number((l==null?void 0:l.boonStripsTime)??0);return Qt(M,x,a)},Wn=o=>On(o),Vn=o=>_n(o),zn=o=>Rn(o),Kn=(o,a=Lt)=>$n(o,a),Gn=(o,a)=>xn(o,a),yn="count",Yn={downContribution:1,healing:1,cleanses:1,strips:1,stability:1,cc:.7,revives:.7,distanceToTag:.7,participation:.7,dodging:.4,dps:.2,damage:.2},Jn={showMvp:!0,topSkillDamageSource:"target",topSkillsMetric:"damage"},Xt=new Map([["bleeding","Bleeding"],["burning","Burning"],["confusion","Confusion"],["poison","Poison"],["torment","Torment"],["vulnerability","Vulnerability"],["weakness","Weakness"],["weakened","Weakness"],["blind","Blind"],["blinded","Blind"],["blinding","Blind"],["cripple","Cripple"],["crippled","Cripple"],["chill","Chill"],["chilled","Chill"],["immob","Immobilize"],["immobile","Immobilize"],["immobilized","Immobilize"],["slow","Slow"],["slowed","Slow"],["fear","Fear"],["feared","Fear"],["taunt","Taunt"],["taunted","Taunt"]]),Qn={Blind:"https://render.guildwars2.com/file/09770136BB76FD0DBE1CC4267DEED54774CB20F6/102837.png",Chill:"https://render.guildwars2.com/file/28C4EC547A3516AF0242E826772DA43A5EAC3DF3/102839.png",Cripple:"https://render.guildwars2.com/file/070325E519C178D502A8160523766070D30C0C19/102838.png",Fear:"https://render.guildwars2.com/file/30307A6E766D74B6EB09EDA12A4A2DE50E4D76F4/102869.png",Immobilize:"https://render.guildwars2.com/file/397A613651BFCA2832B6469CE34735580A2C120E/102844.png",Slow:"https://render.guildwars2.com/file/F60D1EF5271D7B9319610855676D320CD25F01C6/961397.png",Taunt:"https://render.guildwars2.com/file/02EED459AD65FAF7DF32A260E479C625070841B9/1228472.png",Vulnerability:"https://render.guildwars2.com/file/3A394C1A0A3257EB27A44842DDEEF0DF000E1241/102850.png",Weakness:"https://render.guildwars2.com/file/6CB0E64AF9AA292E332A38C1770CE577E2CDE0E8/102853.png"},ft=o=>{if(!o)return null;const a=o.trim().toLowerCase(),l=Xt.get(a);if(l)return l;const M=a.split(/[^a-z]+/).filter(Boolean);for(const x of M){const _=Xt.get(x);if(_)return _}return null},Xn=o=>ft(o),Zt=o=>{const a=new Map;return o&&(Object.values(o).forEach(l=>{if(!(l!=null&&l.icon)||!(l!=null&&l.name))return;const M=ft(l.name);M&&(a.has(M)||a.set(M,l.icon))}),Object.entries(Qn).forEach(([l,M])=>{a.has(l)||a.set(l,M)})),a},Nt=(o,a,l)=>{var M;if(a&&l){const x=(M=l[`b${a}`])==null?void 0:M.name,_=ft(x);if(_)return _}return o?ft(o):null},Zn=o=>{const a=(o==null?void 0:o.account)||"Unknown";return a&&a!=="Unknown"?a:(o==null?void 0:o.name)||"Unknown"||null},ei=o=>{if(!o||o.length===0)return 0;let a=0,l=null;return o.forEach(M=>{const x=Number(M[1]??0);if(Number.isFinite(x)){if(l===null){l=x;return}x>l&&(a+=x-l),l=x}}),a},ti=o=>{if(!o||o.length===0)return 0;let a=0;return o.forEach(l=>{const M=Number(l[0]??0),x=Number(l[1]??0);Number.isFinite(x)&&M!==0&&x>0&&(a+=1)}),a},ni=o=>{const{players:a,targets:l,skillMap:M,buffMap:x}=o,_=o.getPlayerKey||Zn,fe=Zt(x),Q={},ge={};a.forEach(U=>{if(U!=null&&U.notInSquad)return;const W=_(U);W&&(Q[W]||(Q[W]={}),U!=null&&U.totalDamageDist&&U.totalDamageDist.forEach(pe=>{pe&&pe.forEach(E=>{if(!E.id)return;let oe=`Skill ${E.id}`,se;M&&(M[`s${E.id}`]?(oe=M[`s${E.id}`].name||oe,se=M[`s${E.id}`].icon||se):M[`${E.id}`]&&(oe=M[`${E.id}`].name||oe,se=M[`${E.id}`].icon||se));const ae=Nt(oe,E.id,x);if(!ae)return;const Se=x==null?void 0:x[`b${E.id}`],_e=Se==null?void 0:Se.name,le=fe.get(ae)||(Se==null?void 0:Se.icon),Ue=oe.startsWith("Skill ")?_e||ae:oe,Be=se||(Se==null?void 0:Se.icon),Ae=Number(E.connectedHits??0),qe=Number(E.hits??0),De=Ae>0?Ae:qe,Me=Number(E.totalDamage??0);if(!Number.isFinite(De)&&!Number.isFinite(Me))return;const je=ge[ae]||{name:ae,icon:le,applications:0,damage:0};je.applications+=Number.isFinite(De)?De:0,je.damage+=Number.isFinite(Me)?Me:0,!je.icon&&le&&(je.icon=le),ge[ae]=je;const Ie=Q[W][ae]||{icon:le,applications:0,damage:0,skills:{}};Ie.applications+=Number.isFinite(De)?De:0,Ie.damage+=Number.isFinite(Me)?Me:0;const xe=Ie.skills[Ue]||{name:Ue,hits:0,damage:0,icon:Be};xe.hits+=Number.isFinite(De)?De:0,xe.damage+=Number.isFinite(Me)?Me:0,!xe.icon&&Be&&(xe.icon=Be),Ie.skills[Ue]=xe,!Ie.icon&&le&&(Ie.icon=le),Q[W][ae]=Ie})}))});const Re=new Map;a.forEach(U=>{if(U!=null&&U.notInSquad)return;const W=_(U);W&&U!=null&&U.name&&Re.set(U.name,W)});let Ve=0,Ce=0,he=0;return l.forEach(U=>{U!=null&&U.buffs&&U.buffs.forEach(W=>{const pe=Number(W==null?void 0:W.id);if(!Number.isFinite(pe))return;const E=x==null?void 0:x[`b${pe}`],oe=ft(E==null?void 0:E.name);if(!oe||E!=null&&E.classification&&E.classification!=="Condition")return;const se=oe;if(!se)return;const ae=W.statesPerSource||{};he+=1,Object.entries(ae).forEach(([Se,_e])=>{var De;const le=Re.get(Se);if(!le)return;Ce+=1;const Ue=ei(_e),Be=ti(_e);Ve+=Ue;const Ae=((De=Q[le])==null?void 0:De[se])||{applications:0,damage:0,skills:{}};Ae.applicationsFromBuffs=(Ae.applicationsFromBuffs||0)+Ue,Ae.applicationsFromBuffsActive=(Ae.applicationsFromBuffsActive||0)+Be,Q[le]=Q[le]||{},Q[le][se]=Ae;const qe=ge[se]||{name:se,applications:0,damage:0};qe.applicationsFromBuffs=(qe.applicationsFromBuffs||0)+Ue,qe.applicationsFromBuffsActive=(qe.applicationsFromBuffsActive||0)+Be,ge[se]=qe})})}),Object.values(Q).forEach(U=>{Object.values(U).forEach(W=>{typeof W.applicationsFromBuffs=="number"&&(W.applications=W.applicationsFromBuffs)})}),Object.values(ge).forEach(U=>{typeof U.applicationsFromBuffs=="number"&&(U.applications=U.applicationsFromBuffs)}),{playerConditions:Q,summary:ge,meta:{buffStateApplicationsTotal:Ve,targetBuffEntriesSeen:he,buffStateSourcesSeen:Ce}}},ii=new Set(["Vulnerability","Weakness","Blind","Cripple","Chill","Immobilize","Slow","Fear","Taunt"]),oi=[{id:"damage",label:"Damage",field:"damage",source:"dpsAll"},{id:"directDmg",label:"Direct Damage",field:"directDmg",source:"statsTargets"},{id:"connectedDamageCount",label:"Connected Damage Count",field:"connectedDamageCount",source:"statsTargets"},{id:"connectedDirectDamageCount",label:"Connected Direct Damage Count",field:"connectedDirectDamageCount",source:"statsTargets"},{id:"battleStandardHits",label:"Battle Standard Tracking"},{id:"criticalRate",label:"Critical Rate",field:"criticalRate",isRate:!0,isPercent:!0,denomField:"critableDirectDamageCount",source:"statsTargets"},{id:"criticalDmg",label:"Critical Damage",field:"criticalDmg",source:"statsTargets"},{id:"flankingRate",label:"Flanking Rate",field:"flankingRate",isRate:!0,isPercent:!0,denomField:"connectedDirectDamageCount",source:"statsTargets"},{id:"glanceRate",label:"Glance Rate",field:"glanceRate",isRate:!0,isPercent:!0,denomField:"connectedDirectDamageCount",source:"statsTargets"},{id:"missed",label:"Missed",field:"missed",source:"statsTargets"},{id:"evaded",label:"Evaded (enemy)",field:"evaded",source:"statsTargets"},{id:"blocked",label:"Blocked (enemy)",field:"blocked",source:"statsTargets"},{id:"interrupts",label:"Interrupts",field:"interrupts",source:"statsTargets"},{id:"invulned",label:"Invulned",field:"invulned",source:"statsTargets"},{id:"killed",label:"Killed",field:"killed",source:"statsTargets"},{id:"downed",label:"Downed",field:"downed",source:"statsTargets"},{id:"downContribution",label:"Down Contribution",field:"downContribution",source:"statsTargets"},{id:"downContributionPercent",label:"Down Contribution %",isRate:!0,isPercent:!0},{id:"againstDownedDamage",label:"Against Downed Damage",field:"againstDownedDamage",source:"statsTargets"},{id:"appliedCrowdControl",label:"Applied CC",field:"appliedCrowdControl",source:"statsTargets"},{id:"appliedCrowdControlDuration",label:"Applied CC Duration",field:"appliedCrowdControlDuration",source:"statsTargets"},{id:"appliedCrowdControlDownContribution",label:"Applied CC Down Contribution",field:"appliedCrowdControlDownContribution",source:"statsTargets"},{id:"appliedCrowdControlDurationDownContribution",label:"Applied CC Duration Down Contribution",field:"appliedCrowdControlDurationDownContribution",source:"statsTargets"},{id:"boonStrips",label:"Boon Strips",field:"boonStrips",source:"support"}],si=[{id:"damageTaken",label:"Damage Taken",field:"damageTaken"},{id:"damageTakenCount",label:"Damage Taken Count",field:"damageTakenCount"},{id:"conditionDamageTaken",label:"Condition Damage Taken",field:"conditionDamageTaken"},{id:"conditionDamageTakenCount",label:"Condition Damage Taken Count",field:"conditionDamageTakenCount"},{id:"powerDamageTaken",label:"Power Damage Taken",field:"powerDamageTaken"},{id:"powerDamageTakenCount",label:"Power Damage Taken Count",field:"powerDamageTakenCount"},{id:"downedDamageTaken",label:"Downed Damage Taken",field:"downedDamageTaken"},{id:"downedDamageTakenCount",label:"Downed Damage Taken Count",field:"downedDamageTakenCount"},{id:"damageBarrier",label:"Damage Barrier",field:"damageBarrier"},{id:"damageBarrierCount",label:"Damage Barrier Count",field:"damageBarrierCount"},{id:"blockedCount",label:"Blocked Count",field:"blockedCount"},{id:"evadedCount",label:"Evaded Count",field:"evadedCount"},{id:"missedCount",label:"Missed Count",field:"missedCount"},{id:"dodgeCount",label:"Dodge Count",field:"dodgeCount"},{id:"invulnedCount",label:"Invulnerable Count",field:"invulnedCount"},{id:"interruptedCount",label:"Interrupted Count",field:"interruptedCount"},{id:"downCount",label:"Down Count",field:"downCount"},{id:"deadCount",label:"Death Count",field:"deadCount"},{id:"boonStrips",label:"Boon Strips (Incoming)",field:"boonStrips"},{id:"conditionCleanses",label:"Cleanses (Incoming)",field:"conditionCleanses"},{id:"receivedCrowdControl",label:"Crowd Control (Incoming)",field:"receivedCrowdControl"}],ai=[{id:"condiCleanse",label:"Condition Cleanses",field:"condiCleanse"},{id:"condiCleanseTime",label:"Condition Cleanse Time",field:"condiCleanseTime",isTime:!0},{id:"condiCleanseSelf",label:"Condition Cleanse Self",field:"condiCleanseSelf"},{id:"condiCleanseTimeSelf",label:"Condition Cleanse Time Self",field:"condiCleanseTimeSelf",isTime:!0},{id:"boonStrips",label:"Boon Strips",field:"boonStrips"},{id:"boonStripsTime",label:"Boon Strips Time",field:"boonStripsTime",isTime:!0},{id:"boonStripDownContribution",label:"Boon Strip Down Contribution",field:"boonStripDownContribution"},{id:"boonStripDownContributionTime",label:"Boon Strip Down Contribution Time",field:"boonStripDownContributionTime",isTime:!0},{id:"stunBreak",label:"Stun Breaks",field:"stunBreak"},{id:"removedStunDuration",label:"Removed Stun Duration",field:"removedStunDuration",isTime:!0},{id:"resurrects",label:"Resurrects",field:"resurrects"},{id:"resurrectTime",label:"Resurrect Time",field:"resurrectTime",isTime:!0}],ri=["battle standard","glyph of renewal","glyph of the stars","illusion of life","spirit of nature","nature spirit","search and rescue","signet of mercy"],ci=new Set([10244]),li=(o,a)=>{var x;if(ci.has(o))return!0;const l=(a==null?void 0:a[`s${o}`])||(a==null?void 0:a[`${o}`]),M=((x=l==null?void 0:l.name)==null?void 0:x.toLowerCase())||"";return ri.some(_=>M.includes(_))},ui=o=>{if(!o||!Number.isFinite(o))return"--:--";const a=Math.max(0,Math.round(o/1e3)),l=Math.floor(a/3600),M=Math.floor(a%3600/60),x=a%60;return l>0?`${l}:${String(M).padStart(2,"0")}:${String(x).padStart(2,"0")}`:`${M}:${String(x).padStart(2,"0")}`},Tt={Guardian:"#72C1D9",Dragonhunter:"#72C1D9",Firebrand:"#72C1D9",Willbender:"#72C1D9",Revenant:"#D16E5A",Herald:"#D16E5A",Renegade:"#D16E5A",Vindicator:"#D16E5A",Warrior:"#FFD166",Berserker:"#FFD166",Spellbreaker:"#FFD166",Bladesworn:"#FFD166",Engineer:"#D09C59",Scrapper:"#D09C59",Holosmith:"#D09C59",Mechanist:"#D09C59",Ranger:"#8CDC82",Druid:"#8CDC82",Soulbeast:"#8CDC82",Untamed:"#8CDC82",Thief:"#C08F95",Daredevil:"#C08F95",Deadeye:"#C08F95",Specter:"#C08F95",Elementalist:"#F68A87",Tempest:"#F68A87",Weaver:"#F68A87",Catalyst:"#F68A87",Mesmer:"#B679D5",Chronomancer:"#B679D5",Mirage:"#B679D5",Virtuoso:"#B679D5",Necromancer:"#52A76F",Reaper:"#52A76F",Scourge:"#52A76F",Harbinger:"#52A76F",Ritualist:"#52A76F",Luminary:"#72C1D9",Conduit:"#D16E5A",Paragon:"#FFD166",Amalgam:"#D09C59",Galeshot:"#8CDC82",Antiquary:"#C08F95",Evoker:"#F68A87",Troubadour:"#B679D5",Unknown:"#64748B"};function en(o){return Tt[o]||Tt.Unknown}const mi=o=>{if(o==null||o==="")return 0;if(typeof o=="number")return!Number.isFinite(o)||o<=0?0:o>1e12?o:o*1e3;if(o instanceof Date){const fe=o.getTime();return Number.isFinite(fe)&&fe>0?fe:0}const a=String(o).trim();if(!a)return 0;const l=Number(a);if(Number.isFinite(l)&&l>0)return l>1e12?l:l*1e3;const M=Date.parse(a);if(Number.isFinite(M)&&M>0)return M;const x=a.replace(/([+-]\d{2})$/,"$1:00"),_=Date.parse(x);return Number.isFinite(_)&&_>0?_:0},Je=(o,a)=>mi((o==null?void 0:o.uploadTime)??(a==null?void 0:a.uploadTime)??(o==null?void 0:o.timeStartStd)??(o==null?void 0:o.timeStart)??(o==null?void 0:o.timeEndStd)??(o==null?void 0:o.timeEnd)??(o==null?void 0:o.timeStartText)??(o==null?void 0:o.timeEndText)),di=({logs:o,precomputedStats:a,mvpWeights:l,statsViewSettings:M,disruptionMethod:x})=>{const _=(()=>{const Ce=o.filter(he=>he.details&&he.details.players&&he.details.players.length>0);return console.log("[useStatsAggregation] Filtering logs:",{total:o.length,passed:Ce.length,statuses:o.map(he=>he.status),hasDetails:o.map(he=>!!he.details)}),Ce})(),fe=M||Jn,Q=l||Yn,ge=Ce=>{if(!Ce||typeof Ce!="object")return Ce;const he=Array.isArray(Ce.fightBreakdown)?Ce.fightBreakdown:null;if(!he||he.length===0)return Ce;const U=new Map,W=new Map;o.forEach(E=>{var ae;const oe=(E==null?void 0:E.filePath)||(E==null?void 0:E.id);oe&&U.set(String(oe),E);const se=(E==null?void 0:E.permalink)||((ae=E==null?void 0:E.details)==null?void 0:ae.permalink);typeof se=="string"&&se.trim()&&W.set(se.trim(),E)});const pe=he.map(E=>{if(!E||typeof E!="object"||Number(E.timestamp)>0)return E;const se=E.id?String(E.id):"",ae=typeof E.permalink=="string"?E.permalink.trim():"",Se=(se?U.get(se):void 0)||(ae?W.get(ae):void 0);if(!Se)return E;const _e=Je(Se==null?void 0:Se.details,Se);return _e?{...E,timestamp:_e}:E});return{...Ce,fightBreakdown:pe}},Re=(()=>{if(a)return ge(a);const Ce=x||yn,he=fe.topSkillDamageSource||"target",U=fe.topSkillsMetric||"damage",W=_.length;let pe=0,E=0,oe=0,se=0,ae=0,Se=0,_e=0,le=0;const Ue=e=>{const n=((e==null?void 0:e.players)||[]).filter(K=>!K.notInSquad);let u=0,s=0,k=0,S=0;return n.forEach(K=>{var ne;const v=(ne=K.defenses)==null?void 0:ne[0];if(!v)return;const J=Number(v.downCount||0),ue=Number(v.deadCount||0);u+=J+ue,k+=ue}),n.forEach(K=>{!K.statsTargets||K.statsTargets.length===0||K.statsTargets.forEach(v=>{const J=v==null?void 0:v[0];if(!J)return;const ue=Number(J.downed||0),ne=Number(J.killed||0);s+=ue+ne,S+=ne})}),{squadDownsDeaths:u,enemyDownsDeaths:s,squadDeaths:k,enemyDeaths:S}},Be=e=>{const{squadDownsDeaths:t,enemyDownsDeaths:n}=Ue(e);return t>0||n>0?n>t:typeof(e==null?void 0:e.success)=="boolean"?e.success:!1},Ae=new Map,qe=new Set(["boonStripsTime","condiCleanseTime","condiCleanseTimeSelf"]),De={},Me={},je=new Map,Ie={},xe={},Fe={},Ze=new Map,Qe=new Map,At=new Set(Object.keys(Tt)),Mt=Object.keys(Tt).filter(e=>e&&e!=="Unknown").sort((e,t)=>t.length-e.length),wt=["Guardian","Revenant","Warrior","Engineer","Ranger","Thief","Elementalist","Mesmer","Necromancer"],st=e=>{if(!e)return"Unknown";const t=String(e).replace(/\s*\([^)]*\)\s*$/,"").replace(/\s*\[[^\]]*\]\s*$/,"").replace(/\s\d+$/,"").trim();if(At.has(t))return t;const n=t.toLowerCase();for(const s of Mt)if(n.includes(s.toLowerCase()))return s;return wt.find(s=>n.includes(s.toLowerCase()))||t||"Unknown"},gi=e=>e!=null&&e.classification?e.classification==="Boon":!0,vt=new Map,Et=new Map,gt=()=>({totalHits:0,blocked:0,evaded:0,glanced:0,missed:0,invulned:0,interrupted:0,totalMitigation:0,minMitigation:0}),ie=e=>{const t=Number(e);return Number.isFinite(t)?t:0},rn=e=>{const t=String(e).split("|"),n=t[0]||"Unknown",u=st(t[1]||"Unknown"),s=t[2]||n||"Unknown";return{name:n,profession:u,account:s}},cn=(e,t,n)=>{let u=e.get(t);return u?n.profession&&!u.professionList.includes(n.profession)&&u.professionList.push(n.profession):(u={account:n.account,name:n.name,profession:n.profession,professionList:n.profession?[n.profession]:[],activeMs:0,mitigationTotals:gt()},e.set(t,u)),u},ln=(e,t,n)=>{let u=e.get(t);return u?n.profession&&!u.professionList.includes(n.profession)&&u.professionList.push(n.profession):(u={account:n.account,name:n.name,profession:n.profession,professionList:n.profession?[n.profession]:[],activeMs:0,mitigationTotals:gt(),minion:n.minion},e.set(t,u)),u},un=(e,t)=>{e.totalHits+=ie((t==null?void 0:t.skill_hits)??(t==null?void 0:t.skillHits)),e.blocked+=ie(t==null?void 0:t.blocked),e.evaded+=ie(t==null?void 0:t.evaded),e.glanced+=ie(t==null?void 0:t.glanced),e.missed+=ie(t==null?void 0:t.missed),e.invulned+=ie(t==null?void 0:t.invulned),e.interrupted+=ie(t==null?void 0:t.interrupted),e.totalMitigation+=ie((t==null?void 0:t.avoided_damage)??(t==null?void 0:t.avoidedDamage)),e.minMitigation+=ie((t==null?void 0:t.min_avoided_damage)??(t==null?void 0:t.minAvoidedDamage))},pi=e=>Object.values(e).some(t=>t>0);console.log("[useStatsAggregation] Starting aggregation loop",{validLogsCount:_.length});const Ft=(e,t,n)=>{var k,S,K,v;const u=`s${e}`;if((k=t==null?void 0:t[u])!=null&&k.name)return t[u].name;if((S=t==null?void 0:t[String(e)])!=null&&S.name)return t[String(e)].name;const s=`b${e}`;return(K=n==null?void 0:n[s])!=null&&K.name?n[s].name:(v=n==null?void 0:n[String(e)])!=null&&v.name?n[String(e)].name:`Unknown Skill ${e}`},pt=new Map,at=e=>{const t=pt.get(e);if(!t)return{hasSkill:!1,avg:1,min:1,hits:0};const n=t.connectedHits||0,u=n>0?t.totalDamage/n:0,s=t.minCount>0?t.minTotal/t.minCount:0;return{hasSkill:!0,avg:u,min:s,hits:n}},Bt="Ashtonlightstone.9145",mn="Illusionary Warden",Ot=[],rt=[],Rt=[],_t=[],dn=new Map,fn=new Map,gn=(e,t,n)=>{const u=e.get(t)||gt();return u.totalHits+=n.totalHits,u.blocked+=n.blocked,u.evaded+=n.evaded,u.glanced+=n.glanced,u.missed+=n.missed,u.invulned+=n.invulned,u.interrupted+=n.interrupted,e.set(t,u),u};_.forEach(e=>{const t=e.details;if(!t)return;(t.targets||[]).forEach(u=>{const s=(u==null?void 0:u.totalDamageDist)||[],k=Array.isArray(s)?s[0]:null;k==null||k.forEach(S=>{if(!(S!=null&&S.id))return;const K=Number(S.id),v=pt.get(K)||{totalDamage:0,connectedHits:0,minTotal:0,minCount:0};v.totalDamage+=Number(S.totalDamage||0),v.connectedHits+=Number(S.connectedHits||0);const J=Number.isFinite(Number(S.min))?Number(S.min):0;v.minTotal+=J,v.minCount+=1,pt.set(K,v)})})}),_.forEach((e,t)=>{var Le,L;const n=e.details;if(!n)return;const u=n.players;console.log(`[useStatsAggregation] Processing log ${t}:`,{playerCount:u==null?void 0:u.length,hasTargets:!!n.targets,firstPlayer:u!=null&&u[0]?{account:u[0].account,notInSquad:u[0].notInSquad}:"none"});const s=n.targets||[],k=n.skillMap||{},S=n.buffMap||{},K=new Map,v=new Map;s.forEach(i=>{const d=(i==null?void 0:i.totalDamageDist)||[],N=Array.isArray(d)?d[0]:null;N==null||N.forEach(I=>{var re;if(!(I!=null&&I.id))return;const R=Number(I.id),b=((re=k==null?void 0:k[R])==null?void 0:re.name)||I.name||I.skillName||String(R),Z=K.get(R)||{totalDamage:0,connectedHits:0,minTotal:0,minCount:0};Z.totalDamage+=Number(I.totalDamage||0),Z.connectedHits+=Number(I.connectedHits||0);const H=Number.isFinite(Number(I.min))?Number(I.min):0;Z.minTotal+=H,Z.minCount+=1,K.set(R,Z);const Y=v.get(b)||{totalDamage:0,connectedHits:0,minTotal:0,minCount:0};Y.totalDamage+=Number(I.totalDamage||0),Y.connectedHits+=Number(I.connectedHits||0);const me=Number.isFinite(Number(I.min))?Number(I.min):0;Y.minTotal+=me,Y.minCount+=1,v.set(b,Y)})});const J=i=>{const d=K.get(i);if(!d||d.connectedHits<=0)return{avg:1,min:1};const N=d.connectedHits>0?d.totalDamage/d.connectedHits:0,I=d.minCount>0?d.minTotal/d.minCount:N;return{avg:N||1,min:I||1}},ue=i=>{const d=v.get(i);if(!d||d.connectedHits<=0)return{avg:1,min:1};const N=d.connectedHits>0?d.totalDamage/d.connectedHits:0,I=d.minCount>0?d.minTotal/d.minCount:N;return{avg:N||1,min:I||1}},ne=n.combatReplayMetaData||{},w=(ne==null?void 0:ne.inchToPixel)>0?ne.inchToPixel:1,P=(ne==null?void 0:ne.pollingRate)>0?ne.pollingRate:1,$=5e3,c=i=>Array.isArray(i)?i.map(d=>Array.isArray(d)?[Number(d[0]),Number(d[1])]:null).filter(d=>!!d&&Number.isFinite(d[0])):[];let p=[],g=n.durationMS||0,F=!1;const O=u.find(i=>(i==null?void 0:i.hasCommanderTag)&&!(i!=null&&i.notInSquad));(Le=O==null?void 0:O.combatReplayData)!=null&&Le.positions&&(p=O.combatReplayData.positions,c(O.combatReplayData.dead).forEach(([d])=>{d>0&&(F=!0,g=Math.min(g,d))}));const T=i=>{var Y;const d=(Y=i.statsAll)==null?void 0:Y[0];if((d==null?void 0:d.distToCom)!==void 0&&(d==null?void 0:d.distToCom)!=="Infinity")return Math.round(Number(d.distToCom));if((d==null?void 0:d.stackDist)!==void 0)return Math.round(Number(d.stackDist))||0;if(i.hasCommanderTag)return 0;const N=i.combatReplayData;if(!(N!=null&&N.positions)||!p.length)return 0;const I=N.positions,R=c(N.dead),b=c(N.down),Z=Math.floor((N.start||0)/P);let H=0;if(R.length&&b.length)for(const[me]of R){if(me<0)continue;const re=Math.max(0,Math.floor(me/P))-Z;for(const[A,j]of b){if(me!==j)continue;const z=F&&A>g?Math.max(1,Math.floor(g/P)):re,Te=Math.max(0,Math.min(z,I.length,p.length));if(Te<=0)continue;let ce=0;for(let ve=0;ve<Te;ve++){const[X,ke]=I[ve],[be,de]=p[ve];ce+=Math.hypot(X-be,ke-de)}H=Math.round(ce/Te/w)}}return H},B=u.filter(i=>!i.notInSquad);oe+=B.length,se+=s.filter(i=>!i.isFake).length,Gn(u,{durationMS:n.durationMS,buffMap:n.buffMap});const{squadDeaths:te,enemyDeaths:r}=Ue(n);ae+=te,Se+=r,le+=te,_e+=r,Be(n)?pe++:E++;const f=n.skillMap?Number((L=Object.keys(n.skillMap).find(i=>{var d,N;return((N=(d=n.skillMap)==null?void 0:d[i])==null?void 0:N.name)==="Battle Standard"}))==null?void 0:L.replace(/^s/,"")):null;u.forEach((i,d)=>{var et,tt,ct,lt,Ht,bt,ht,Dn,Nn,Tn,An,Mn;if(i.notInSquad)return;const N=i.account||"Unknown",I=N!=="Unknown"?N:i.name||"Unknown",R=i.name||"Unknown";Ae.has(I)||Ae.set(I,{name:R,account:I,downContrib:0,cleanses:0,strips:0,stab:0,healing:0,barrier:0,cc:0,logsJoined:0,totalDist:0,distCount:0,dodges:0,downs:0,deaths:0,totalFightMs:0,offenseTotals:{},offenseRateWeights:{},defenseActiveMs:0,defenseTotals:{},supportActiveMs:0,supportTotals:{},healingActiveMs:0,healingTotals:{},profession:i.profession||"Unknown",professions:new Set,professionTimeMs:{},isCommander:!1,damage:0,dps:0,revives:0,outgoingConditions:{},incomingConditions:{}});const b=Ae.get(I);if(i.hasCommanderTag&&(b.isCommander=!0),i.profession&&i.profession!=="Unknown"){b.profession=i.profession,b.professions.add(i.profession);const m=Array.isArray(i.activeTimes)&&typeof i.activeTimes[0]=="number"?i.activeTimes[0]:n.durationMS||0;b.professionTimeMs[i.profession]=(b.professionTimeMs[i.profession]||0)+m}b.logsJoined++,b.downContrib+=Wn(i),b.cleanses+=qn(i),b.strips+=jn(i,Ce),b.healing+=Vn(i),b.barrier+=zn(i),b.cc+=Kn(i,Ce),b.stab+=i.stabGeneration||0;const Z=T(i);Z<=$&&(b.totalDist+=Z,b.distCount++),(et=i.defenses)!=null&&et[0]&&(b.dodges+=i.defenses[0].dodgeCount||0,b.downs+=i.defenses[0].downCount||0,b.deaths+=i.defenses[0].deadCount||0),n.durationMS&&(b.totalFightMs+=n.durationMS);const H=Array.isArray(i.activeTimes)&&typeof i.activeTimes[0]=="number"?i.activeTimes[0]:n.durationMS||0;b.defenseActiveMs+=H,b.supportActiveMs+=H,b.healingActiveMs+=H,Array.isArray(i.buffUptimes)&&i.buffUptimes.length>0&&i.buffUptimes.forEach(m=>{var wn,vn,En,Fn;if(typeof(m==null?void 0:m.id)!="number")return;const h=`b${m.id}`,D=((wn=n.buffMap)==null?void 0:wn[h])||((vn=n.buffMap)==null?void 0:vn[String(m.id)]);if(!D||gi(D))return;const ee=Number(((Fn=(En=m.buffData)==null?void 0:En[0])==null?void 0:Fn.uptime)??0);if(!Number.isFinite(ee)||ee<=0)return;const Pe=(D==null?void 0:D.stacking)??!1,Ke=(Pe?ee:ee/100)*H;if(!Number.isFinite(Ke)||Ke<=0)return;const $e=Xn(D==null?void 0:D.name);if($e&&ii.has($e)&&(!(D!=null&&D.classification)||D.classification==="Condition")){const Ut=Ke/1e3,Ge=D==null?void 0:D.icon,kt=Ie[$e]||{name:$e,icon:Ge,applications:0,damage:0};kt.applicationsFromUptime=(kt.applicationsFromUptime||0)+Ut,!kt.icon&&Ge&&(kt.icon=Ge),Ie[$e]=kt;const Ct=b.outgoingConditions[$e]||{applications:0,damage:0,skills:{},icon:Ge};Ct.applicationsFromUptime=(Ct.applicationsFromUptime||0)+Ut,!Ct.icon&&Ge&&(Ct.icon=Ge),b.outgoingConditions[$e]=Ct;const St=xe[$e]||{name:$e,icon:Ge,applications:0,damage:0};St.applicationsFromUptime=(St.applicationsFromUptime||0)+Ut,!St.icon&&Ge&&(St.icon=Ge),xe[$e]=St;const Dt=b.incomingConditions[$e]||{applications:0,damage:0,skills:{},icon:Ge};Dt.applicationsFromUptime=(Dt.applicationsFromUptime||0)+Ut,!Dt.icon&&Ge&&(Dt.icon=Ge),b.incomingConditions[$e]=Dt}Ze.has(h)||Ze.set(h,{name:D==null?void 0:D.name,stacking:Pe,icon:D==null?void 0:D.icon}),Qe.has(h)||Qe.set(h,new Map);const ot=Qe.get(h),mt=b.account||i.account||i.name||"Unknown";let it=ot.get(mt);it||(it={account:mt,profession:b.profession||i.profession||"Unknown",professions:new Set,professionTimeMs:{},totalMs:0,durationMs:0},ot.set(mt,it));const dt=i.profession||b.profession;dt&&dt!=="Unknown"&&(it.professions.add(dt),it.professionTimeMs[dt]=(it.professionTimeMs[dt]||0)+H,it.profession=dt),it.totalMs+=Ke,it.durationMs+=H}),(tt=i.defenses)!=null&&tt[0]&&si.forEach(m=>{const h=Number(i.defenses[0][m.field]??0);Number.isFinite(h)&&(b.defenseTotals[m.id]=(b.defenseTotals[m.id]||0)+h)}),(ct=i.support)!=null&&ct[0]&&ai.forEach(m=>{let h=Number(i.support[0][m.field]??0);Number.isFinite(h)&&(qe.has(m.field)&&h>999999&&(h=0),b.supportTotals[m.id]=(b.supportTotals[m.id]||0)+h)});const Y=(m,h)=>{Number.isFinite(h)&&(b.healingTotals[m]=(b.healingTotals[m]||0)+h)},me=(m,h)=>Array.isArray(m)?m.reduce((D,ee)=>D+Number((ee==null?void 0:ee[h])??0),0):0,re=(m,h,D)=>{if(!Number.isFinite(D)||D<=0)return;const ee=u[h],Pe=h===d,nt=ee==null?void 0:ee.notInSquad,Ke=!nt,$e=Ke&&(ee==null?void 0:ee.group)!=null&&ee.group===i.group;Y(m,D),Ke&&Y(`squad${m[0].toUpperCase()}${m.slice(1)}`,D),$e&&Y(`group${m[0].toUpperCase()}${m.slice(1)}`,D),Pe&&Y(`self${m[0].toUpperCase()}${m.slice(1)}`,D),nt&&Y(`offSquad${m[0].toUpperCase()}${m.slice(1)}`,D)};if(Array.isArray(i.rotation)){let m=0;i.rotation.forEach(h=>{var ee;if(!(h!=null&&h.id)||!li(h.id,n.skillMap))return;const D=((ee=h.skills)==null?void 0:ee.length)||0;D>0&&(m+=D,Y(`resUtility_s${h.id}`,D))}),m>0&&Y("resUtility",m)}const A=(lt=i.extHealingStats)==null?void 0:lt.outgoingHealingAllies;Array.isArray(A)&&A.forEach((m,h)=>{const D=me(m,"healing"),ee=me(m,"downedHealing");re("healing",h,D),re("downedHealing",h,ee)});const j=(Ht=i.extBarrierStats)==null?void 0:Ht.outgoingBarrierAllies;Array.isArray(j)&&j.forEach((m,h)=>{const D=me(m,"barrier");re("barrier",h,D)});const z=(bt=i.statsAll)==null?void 0:bt[0],Te=(ht=i.dpsAll)==null?void 0:ht[0],ce=(Dn=i.support)==null?void 0:Dn[0];if(oi.forEach(m=>{if(m.id==="downContributionPercent"||!m.field)return;let h=0,D=0;m.source==="dpsAll"&&Te?h=Number(Te[m.field]??0):m.source==="statsAll"&&z?(h=Number(z[m.field]??0),D=Number(z[m.denomField||m.weightField||"connectedDamageCount"]??0)):m.source==="support"&&ce?h=Number(ce[m.field]??0):i.statsTargets&&i.statsTargets.forEach(ee=>{ee!=null&&ee[0]&&(h+=Number(ee[0][m.field]??0),D+=Number(ee[0][m.denomField||m.weightField||"connectedDamageCount"]??0))}),Number.isFinite(h)&&(b.offenseTotals[m.id]=(b.offenseTotals[m.id]||0)+h,m.isRate&&D>0&&(b.offenseRateWeights[m.id]=(b.offenseRateWeights[m.id]||0)+D))}),i.targetDamageDist&&Number.isFinite(f)){const m=i.targetDamageDist.flatMap(h=>h||[]).flatMap(h=>h||[]).reduce((h,D)=>D!=null&&D.id&&D.id===f?h+((D==null?void 0:D.connectedHits)||0):h,0);b.offenseTotals.battleStandardHits=(b.offenseTotals.battleStandardHits||0)+m}b.revives+=((Tn=(Nn=i.support)==null?void 0:Nn[0])==null?void 0:Tn.resurrects)||0,Te&&(b.damage+=Te.damage||0,b.dps+=Te.dps||0);const ve=m=>{var Pe,nt,Ke,$e;let h=`Skill ${m.id}`;const D=((Pe=n.skillMap)==null?void 0:Pe[`s${m.id}`])||((nt=n.skillMap)==null?void 0:nt[`${m.id}`]);let ee=D==null?void 0:D.icon;if(D!=null&&D.name&&(h=D.name),h.startsWith("Skill ")){const ot=Nt(h,m.id,n.buffMap);ot&&(h=ot,ee=(($e=(Ke=n.buffMap)==null?void 0:Ke[`b${m.id}`])==null?void 0:$e.icon)||ee)}return{name:h,icon:ee}},X=m=>{if(!(m!=null&&m.id))return;const{name:h,icon:D}=ve(m);De[m.id]||(De[m.id]={name:h,icon:D,damage:0,hits:0,downContribution:0}),De[m.id].name.startsWith("Skill ")&&!h.startsWith("Skill ")&&(De[m.id].name=h),!De[m.id].icon&&D&&(De[m.id].icon=D),De[m.id].damage+=m.totalDamage,De[m.id].hits+=m.connectedHits,De[m.id].downContribution+=Number(m.downContribution||0)},ke=i.account||i.name||"Unknown",be=i.profession||"Unknown",de=`${ke}|${be}`;let we=je.get(de);we||(we={key:de,account:ke,displayName:ke,profession:be,professionList:[be],totalFightMs:0,skills:new Map},je.set(de,we)),we.professionList.includes(be)||we.professionList.push(be),we.totalFightMs+=n.durationMS||0;const We=m=>{if(!(m!=null&&m.id))return;const{name:h,icon:D}=ve(m),ee=`s${m.id}`;let Pe=we.skills.get(ee);Pe||(Pe={id:ee,name:h,icon:D,damage:0,downContribution:0},we.skills.set(ee,Pe)),Pe.name.startsWith("Skill ")&&!h.startsWith("Skill ")&&(Pe.name=h),!Pe.icon&&D&&(Pe.icon=D),Pe.damage+=Number(m.totalDamage||0),Pe.downContribution+=Number(m.downContribution||0)};he==="total"?(An=i.totalDamageDist)==null||An.forEach(m=>{m==null||m.forEach(h=>{X(h),We(h)})}):(Mn=i.targetDamageDist)==null||Mn.forEach(m=>{m==null||m.forEach(h=>{h==null||h.forEach(D=>{X(D),We(D)})})}),i.totalDamageTaken&&i.totalDamageTaken.forEach(m=>{m==null||m.forEach(h=>{var nt,Ke,$e,ot;if(!(h!=null&&h.id))return;let D=`Skill ${h.id}`;const ee=((nt=n.skillMap)==null?void 0:nt[`s${h.id}`])||((Ke=n.skillMap)==null?void 0:Ke[`${h.id}`]);let Pe=ee==null?void 0:ee.icon;if(ee!=null&&ee.name&&(D=ee.name),D.startsWith("Skill ")){const mt=Nt(D,h.id,n.buffMap);mt&&(D=mt,Pe=((ot=($e=n.buffMap)==null?void 0:$e[`b${h.id}`])==null?void 0:ot.icon)||Pe)}Me[h.id]||(Me[h.id]={name:D,icon:Pe,damage:0,hits:0}),(!Me[h.id].name.startsWith("Skill ")||D.startsWith("Skill "))&&(Me[h.id].name=D),!Me[h.id].icon&&Pe&&(Me[h.id].icon=Pe),Me[h.id].damage+=h.totalDamage,Me[h.id].hits+=h.hits})})}),s.forEach(i=>{if(i!=null&&i.isFake)return;const d=st((i==null?void 0:i.profession)||(i==null?void 0:i.name)||(i==null?void 0:i.id));d&&(Fe[d]=(Fe[d]||0)+1)});const C=ni({players:u,targets:s,skillMap:n.skillMap,buffMap:n.buffMap,getPlayerKey:i=>i.account&&i.account!=="Unknown"?i.account:i.name||null}),q=Zt(n.buffMap);Object.entries(C.playerConditions).forEach(([i,d])=>{const N=Ae.get(i);N&&Object.entries(d).forEach(([I,R])=>{const b=N.outgoingConditions[I]||{applications:0,damage:0,skills:{},icon:R.icon};b.applications+=Number(R.applications||0),b.damage+=Number(R.damage||0),R.applicationsFromBuffs&&(b.applicationsFromBuffs=(b.applicationsFromBuffs||0)+R.applicationsFromBuffs),R.applicationsFromBuffsActive&&(b.applicationsFromBuffsActive=(b.applicationsFromBuffsActive||0)+R.applicationsFromBuffsActive),Object.entries(R.skills||{}).forEach(([Z,H])=>{const Y=b.skills[Z]||{name:H.name,hits:0,damage:0,icon:H.icon};Y.hits+=Number(H.hits||0),Y.damage+=Number(H.damage||0),!Y.icon&&H.icon&&(Y.icon=H.icon),b.skills[Z]=Y}),!b.icon&&R.icon&&(b.icon=R.icon),N.outgoingConditions[I]=b})}),Object.entries(C.summary).forEach(([i,d])=>{const N=Ie[i]||{name:d.name||i,icon:d.icon,applications:0,damage:0};N.applications+=Number(d.applications||0),N.damage+=Number(d.damage||0),d.applicationsFromBuffs&&(N.applicationsFromBuffs=(N.applicationsFromBuffs||0)+d.applicationsFromBuffs),d.applicationsFromBuffsActive&&(N.applicationsFromBuffsActive=(N.applicationsFromBuffsActive||0)+d.applicationsFromBuffsActive),!N.icon&&d.icon&&(N.icon=d.icon),Ie[i]=N}),B.forEach(i=>{const d=i.account&&i.account!=="Unknown"?i.account:i.name||"Unknown",N=Ae.get(d);!N||!i.totalDamageTaken||i.totalDamageTaken.forEach(I=>I==null?void 0:I.forEach(R=>{var ve,X,ke,be,de,we;if(!(R!=null&&R.id))return;let b=`Skill ${R.id}`;const Z=((ve=n.skillMap)==null?void 0:ve[`s${R.id}`])||((X=n.skillMap)==null?void 0:X[`${R.id}`]);Z!=null&&Z.name&&(b=Z.name);const H=Nt(b,R.id,n.buffMap);if(!H)return;const Y=(be=(ke=n.buffMap)==null?void 0:ke[`b${R.id}`])==null?void 0:be.name,me=q.get(H)||((we=(de=n.buffMap)==null?void 0:de[`b${R.id}`])==null?void 0:we.icon),re=(Z==null?void 0:Z.icon)||me;b.startsWith("Skill ")&&(Y||H)&&(b=Y||H);const A=Number(R.hits??0),j=Number(R.totalDamage??0),z=xe[H]||{name:H,icon:me,applications:0,damage:0};z.applications+=Number.isFinite(A)?A:0,z.damage+=Number.isFinite(j)?j:0,!z.icon&&me&&(z.icon=me),xe[H]=z;const Te=N.incomingConditions[H]||{applications:0,damage:0,skills:{},icon:me};Te.applications+=Number.isFinite(A)?A:0,Te.damage+=Number.isFinite(j)?j:0;const ce=Te.skills[b]||{name:b,hits:0,damage:0,icon:re};ce.hits+=Number.isFinite(A)?A:0,ce.damage+=Number.isFinite(j)?j:0,!ce.icon&&re&&(ce.icon=re),Te.skills[b]=ce,!Te.icon&&me&&(Te.icon=me),N.incomingConditions[H]=Te}))});const G=n.player_damage_mitigation||n.playerDamageMitigation,y=G&&typeof G=="object"&&Object.keys(G).length>0;y&&Object.entries(G).forEach(([i,d])=>{if(!d||typeof d!="object")return;const N=rn(i),I=cn(vt,N.account,N);Object.values(d).forEach(R=>{ie((R==null?void 0:R.avoided_damage)??(R==null?void 0:R.avoidedDamage))<=0||un(I.mitigationTotals,R)})});const Ne=n.player_minion_damage_mitigation||n.playerMinionDamageMitigation,Oe=Ne&&typeof Ne=="object"&&Object.keys(Ne).length>0;Oe&&Object.entries(Ne).forEach(([i,d])=>{if(!d||typeof d!="object")return;const N=rn(i);Object.entries(d).forEach(([I,R])=>{if(!R||typeof R!="object")return;const b=`${N.account}::${I}`,Z=ln(Et,b,{...N,minion:String(I||"Unknown")});Object.values(R).forEach(H=>{un(Z.mitigationTotals,H)})})}),(!y||!Oe)&&(y||B.forEach(i=>{const d=(i==null?void 0:i.totalDamageTaken)||[];if(!Array.isArray(d)||d.length===0)return;const N=i.account||i.name||"Unknown",I={account:N,name:i.name||N,profession:st(i.profession||"Unknown")};cn(vt,N,I);const R=n.skillMap||{},b=n.buffMap||{},Z=Array.isArray(d)?d[0]:null;if(Z==null||Z.forEach(H=>{if(!(H!=null&&H.id))return;const Y=ie(H.blocked),me=ie(H.evaded),re=ie(H.glance??H.glanced),A=ie(H.missed),j=ie(H.invulned),z=ie(H.interrupted),Te=ie(H.hits??H.connectedHits),ce=Number(H.id),ve=Ft(ce,R,b);if(gn(dn,`${N}::${ce}`,{totalHits:Te,blocked:Y,evaded:me,glanced:re,missed:A,invulned:j,interrupted:z}),N===Bt){const X=pt.get(ce),ke=at(ce),be=ke.hasSkill?ke.hits>0?ke.avg:0:1,de=ke.hasSkill?ke.min||0:1,we=ke.hits>0?re*be/2+(Y+me+A+j+z)*be:0,We=ke.hits>0?re*de/2+(Y+me+A+j+z)*de:0;Rt.push({logId:e.filePath||e.id||t,skillId:H.id,skillName:ve,blocked:Y,evaded:me,glanced:re,missed:A,invulned:j,interrupted:z,totalAvoids:Y+me+re+A+j+z,avg:be,min:de,enemyHits:(X==null?void 0:X.connectedHits)??0,enemyTotalDmg:(X==null?void 0:X.totalDamage)??0,avoidDmg:we,avoidMinDmg:We})}}),N===Bt){const H=(Y,me)=>{let re=0,A=0,j=0;if(!Array.isArray(Y))return{total:re,minTotal:A,hits:j};for(const z of Y){if(!(z!=null&&z.id))continue;const Te=ie(z.blocked),ce=ie(z.evaded),ve=ie(z.glance??z.glanced),X=ie(z.missed),ke=ie(z.invulned),be=ie(z.interrupted),de=Ft(Number(z.id),k,S),we=me(Number(z.id),de);(we.hits??0)>0&&(re+=ve*we.avg/2+(Te+ce+X+ke+be)*we.avg,A+=ve*we.min/2+(Te+ce+X+ke+be)*we.min),j+=ie(z.hits??z.connectedHits)}return{total:re,minTotal:A,hits:j}};_t.push({logId:e.filePath||e.id||t,variant:"current_global_name_taken0",...H(Z,(Y,me)=>{const re=at(Y),A=re.hasSkill?re.hits>0?re.avg:0:1,j=re.hasSkill?re.min||0:1;return{avg:A,min:j,hits:re.hits}})})}}),Oe||B.forEach(i=>{const d=(i==null?void 0:i.minions)||[];if(!Array.isArray(d)||d.length===0)return;const N=i.account||i.name||"Unknown",I={account:N,name:i.name||N,profession:st(i.profession||"Unknown")},R=n.skillMap||{},b=n.buffMap||{};d.forEach(Z=>{const H=(Z==null?void 0:Z.totalDamageTakenDist)||[];if(!Array.isArray(H)||H.length===0)return;let Y=String((Z==null?void 0:Z.name)||"Unknown").replace(/^Juvenile\s+/i,"")||"Unknown";Y.toUpperCase().includes("UNKNOWN")&&(Y="Unknown");const me=`${N}::${Y}`;ln(Et,me,{...I,minion:Y});const re=Array.isArray(H)?H[0]:null;if(re==null||re.forEach(A=>{if(!(A!=null&&A.id))return;const j=ie(A.blocked),z=ie(A.evaded),Te=ie(A.glance??A.glanced),ce=ie(A.missed),ve=ie(A.invulned),X=ie(A.interrupted),ke=ie(A.hits??A.connectedHits),be=Number(A.id),de=Ft(be,R,b);if(gn(fn,`${me}::${be}`,{totalHits:ke,blocked:j,evaded:z,glanced:Te,missed:ce,invulned:ve,interrupted:X}),N===Bt&&Y===mn){const we=pt.get(be),We=at(be),et=We.hasSkill?We.hits>0?We.avg:0:1,tt=We.hasSkill?We.min||0:1,ct=We.hits>0?Te*et/2+(j+z+ce+ve+X)*et:0,lt=We.hits>0?Te*tt/2+(j+z+ce+ve+X)*tt:0;Ot.push({logId:e.filePath||e.id||t,skillId:A.id,skillName:de,blocked:j,evaded:z,glanced:Te,missed:ce,invulned:ve,interrupted:X,totalAvoids:j+z+Te+ce+ve+X,avg:et,min:tt,enemyHits:(we==null?void 0:we.connectedHits)??0,enemyTotalDmg:(we==null?void 0:we.totalDamage)??0,avoidDmg:ct,avoidMinDmg:lt})}}),N===Bt&&Y===mn){const A=(ce,ve)=>{let X=0,ke=0,be=0;if(!Array.isArray(ce))return{total:X,minTotal:ke,hits:be};for(const de of ce){if(!(de!=null&&de.id))continue;const we=ie(de.blocked),We=ie(de.evaded),et=ie(de.glance??de.glanced),tt=ie(de.missed),ct=ie(de.invulned),lt=ie(de.interrupted),Ht=Ft(Number(de.id),k,S),{avg:bt,min:ht}=ve(Number(de.id),Ht);ie(de.hits??de.connectedHits)>0&&(X+=et*bt/2+(we+We+tt+ct+lt)*bt,ke+=et*ht/2+(we+We+tt+ct+lt)*ht),be+=ie(de.hits??de.connectedHits)}return{total:X,minTotal:ke,hits:be}},j=Array.isArray(H)?H[0]||[]:[],z=Array.isArray(H)?H.flat():[],Te=Array.isArray(Z==null?void 0:Z.totalDamageTaken)?Z.totalDamageTaken[0]||[]:[];rt.push({logId:e.filePath||e.id||t,variant:"current_global_name_dist0",...A(j,(ce,ve)=>{const X=at(ce),ke=X.hasSkill?X.hits>0?X.avg:0:1,be=X.hasSkill&&X.min||0;return{avg:ke,min:be}})}),rt.push({logId:e.filePath||e.id||t,variant:"local_name_dist0",...A(j,(ce,ve)=>ue(ve))}),rt.push({logId:e.filePath||e.id||t,variant:"local_id_dist0",...A(j,ce=>J(ce))}),rt.push({logId:e.filePath||e.id||t,variant:"global_name_alllists",...A(z,(ce,ve)=>{const X=at(ce),ke=X.hasSkill?X.hits>0?X.avg:0:1,be=X.hasSkill&&X.min||0;return{avg:ke,min:be}})}),rt.push({logId:e.filePath||e.id||t,variant:"global_name_taken0",...A(Te,(ce,ve)=>{const X=at(ce),ke=X.hasSkill?X.hits>0?X.avg:0:1,be=X.hasSkill&&X.min||0;return{avg:ke,min:be}})})}})}))}),Ot.length>0&&(console.groupCollapsed("[Mitigation Debug] Ashtonlightstone.9145 / Illusionary Warden"),console.table(Ot),rt.length>0&&console.table(rt),console.groupEnd()),Rt.length>0&&(console.groupCollapsed("[Mitigation Debug] Ashtonlightstone.9145 / Player"),console.table(Rt),_t.length>0&&console.table(_t),console.groupEnd());const pn=(e,t)=>{const n=new Map,u=s=>{let k=n.get(s);return k||(k=gt(),n.set(s,k)),k};t.forEach((s,k)=>{const S=k.lastIndexOf("::"),K=S>-1?k.slice(0,S):k,v=S>-1?Number(k.slice(S+2)):Number.NaN,J=Number.isFinite(v)?at(v):{hasSkill:!1,avg:0,min:0,hits:0};if(!J.hasSkill||J.hits<=0)return;const ue=J.avg,ne=J.min,w=s.glanced*ue/2+(s.blocked+s.evaded+s.missed+s.invulned+s.interrupted)*ue,P=s.glanced*ne/2+(s.blocked+s.evaded+s.missed+s.invulned+s.interrupted)*ne;if(w<=0)return;const $=u(K);$.totalHits+=s.totalHits,$.blocked+=s.blocked,$.evaded+=s.evaded,$.glanced+=s.glanced,$.missed+=s.missed,$.invulned+=s.invulned,$.interrupted+=s.interrupted,$.totalMitigation+=w,$.minMitigation+=P}),e.forEach((s,k)=>{const S=n.get(k)||gt();s.mitigationTotals.totalHits=S.totalHits,s.mitigationTotals.blocked=S.blocked,s.mitigationTotals.evaded=S.evaded,s.mitigationTotals.glanced=S.glanced,s.mitigationTotals.missed=S.missed,s.mitigationTotals.invulned=S.invulned,s.mitigationTotals.interrupted=S.interrupted,s.mitigationTotals.totalMitigation=S.totalMitigation,s.mitigationTotals.minMitigation=S.minMitigation})};pn(vt,dn),pn(Et,fn);const bi=W>0?Math.round(oe/W):0,hi=W>0?Math.round(se/W):0,ki=ae>0?(Se/ae).toFixed(2):Se>0?"∞":"0.00",Ci=_e>0?(le/_e).toFixed(2):le>0?"∞":"0.00",bn=(e,t)=>{const u=e.filter(S=>Number.isFinite(S.value)&&(t?S.value>0:S.value>=0)).sort((S,K)=>{const v=t?K.value-S.value:S.value-K.value;return v!==0?v:S.account.localeCompare(K.account)});let s=null,k=0;return u.map((S,K)=>((s===null||S.value!==s)&&(k=K+1,s=S.value),{rank:k,...S}))},qt=Array.from(Ae.values()).map(e=>{const t=Array.from(e.professions).filter(n=>n!=="Unknown");if(e.professionList=t,t.length>0){let n=t[0],u=e.professionTimeMs[n]||0;t.forEach(s=>{const k=e.professionTimeMs[s]||0;k>u&&(u=k,n=s)}),e.profession=n}return{key:e.account,stat:e}}),hn=e=>{const t=Ae.get(e.account);if(!t){const s=e.professionList.length>0?e.professionList:e.profession?[e.profession]:[];return{...e,professionList:s}}const n=t.professionList&&t.professionList.length>0?t.professionList:Array.from(t.professions||[]).filter(s=>s&&s!=="Unknown"),u=t.profession||e.profession;return{...e,profession:u,professionList:n.length>0?n:u?[u]:[],activeMs:t.defenseActiveMs||t.totalFightMs||e.activeMs}},Si=Array.from(vt.values()).map(hn).filter(e=>pi(e.mitigationTotals)).sort((e,t)=>e.account.localeCompare(t.account)),Di=Array.from(Et.values()).map(hn).filter(e=>e.mitigationTotals.totalMitigation>0).sort((e,t)=>{const n=e.account.localeCompare(t.account);return n!==0?n:String(e.minion||"").localeCompare(String(t.minion||""))}),It=(e,t)=>{switch(t){case"downContrib":return e.downContrib;case"barrier":return e.barrier;case"healing":return e.healing;case"dodges":return e.dodges;case"strips":return e.strips;case"cleanses":return e.cleanses;case"cc":return e.cc;case"stability":return e.stab;case"revives":return e.revives;case"dps":return e.dps;case"damage":return e.damage;case"participation":return e.logsJoined;case"closestToTag":return!e.isCommander&&e.distCount>0?e.totalDist/e.distCount:Number.POSITIVE_INFINITY;default:return 0}},ze=(e,t)=>bn(qt.map(({stat:n})=>({account:n.account,profession:n.profession,professionList:n.professionList,value:It(n,e),count:n.logsJoined})),t),He={downContrib:ze("downContrib",!0),barrier:ze("barrier",!0),healing:ze("healing",!0),dodges:ze("dodges",!0),strips:ze("strips",!0),cleanses:ze("cleanses",!0),cc:ze("cc",!0),stability:ze("stability",!0),revives:ze("revives",!0),participation:ze("participation",!0),dps:ze("dps",!0),damage:ze("damage",!0),closestToTag:ze("closestToTag",!1).filter(e=>Number.isFinite(e.value))},Ni={downContrib:"downContrib",barrier:"barrier",healing:"healing",dodges:"dodges",strips:"strips",cleanses:"cleanses",cc:"cc",stability:"stability",closestToTag:"closestToTag"},Ee=e=>{const t=e==null?void 0:e[0];return{value:(t==null?void 0:t.value)??0,player:(t==null?void 0:t.account)??"-",count:(t==null?void 0:t.count)??0,profession:(t==null?void 0:t.profession)??"Unknown",professionList:(t==null?void 0:t.professionList)??[]}},Xe={maxDownContrib:Ee([]),maxBarrier:Ee([]),maxHealing:Ee([]),maxDodges:Ee([]),maxStrips:Ee([]),maxCleanses:Ee([]),maxCC:Ee([]),maxStab:Ee([]),closestToTag:Ee([])},Ye={},Ti=(e,t)=>{if(t==="closestToTag")return It(e,t);const n=Math.max(1,(e.totalFightMs||0)/1e3);return It(e,t)/n};Object.values(Ni).forEach(e=>{const t=e!=="closestToTag";Ye[e]=bn(qt.map(({stat:n})=>({account:n.account,profession:n.profession,professionList:n.professionList,value:Ti(n,e),count:n.logsJoined})),t)}),Xe.maxDownContrib=Ee(Ye.downContrib),Xe.maxBarrier=Ee(Ye.barrier),Xe.maxHealing=Ee(Ye.healing),Xe.maxDodges=Ee(Ye.dodges),Xe.maxStrips=Ee(Ye.strips),Xe.maxCleanses=Ee(Ye.cleanses),Xe.maxCC=Ee(Ye.cc),Xe.maxStab=Ee(Ye.stability),Xe.closestToTag=Ee(Ye.closestToTag);const Ai={maxDownContrib:Ee(He.downContrib),maxBarrier:Ee(He.barrier),maxHealing:Ee(He.healing),maxDodges:Ee(He.dodges),maxStrips:Ee(He.strips),maxCleanses:Ee(He.cleanses),maxCC:Ee(He.cc),maxStab:Ee(He.stability),closestToTag:Ee(He.closestToTag)};let jt={player:"None",account:"None",score:-1,profession:"Unknown",professionList:[],color:"#64748b",topStats:[]},kn,Cn,Sn=0;if(fe!=null&&fe.showMvp){const e={"Down Contribution":"downContribution",Healing:"healing",Cleanses:"cleanses",Strips:"strips",Stability:"stability",CC:"cc",Revives:"revives","Distance to Tag":"distanceToTag",Participation:"participation",Dodging:"dodging",DPS:"dps",Damage:"damage"},t=k=>{const S=e[k];return S?Number(Q[S]||0)>0:!1},n=[],u=k=>[...k||[]].filter(S=>t(S==null?void 0:S.name)).sort((S,K)=>K.ratio-S.ratio||S.rank-K.rank||S.name.localeCompare(K.name)).slice(0,3),s=k=>{var K;if(!k)return;const S=u(k.contribs);return{...k,player:k.name,reason:((K=S[0])==null?void 0:K.name)||"Top Performance",topStats:S}};qt.forEach(({stat:k})=>{let S=0;const K=[],v=(J,ue,ne,w,P=!0)=>{var c,p;if(ne<=0)return;const $=((c=ue[0])==null?void 0:c.value)||0;if($&&Number.isFinite(J)&&(P?J>0:J<Number.POSITIVE_INFINITY)){const g=P?J/$:$/J;S+=g*ne;const F=((p=ue.find(O=>O.account===k.account))==null?void 0:p.rank)||0;K.push({name:w,ratio:g,val:J.toLocaleString(),rank:F})}};v(k.downContrib,He.downContrib,Q.downContribution,"Down Contribution"),v(k.healing,He.healing,Q.healing,"Healing"),v(k.cleanses,He.cleanses,Q.cleanses,"Cleanses"),v(k.strips,He.strips,Q.strips,"Strips"),v(k.stab,He.stability,Q.stability,"Stability"),v(k.cc,He.cc,Q.cc,"CC"),v(k.revives,He.revives,Q.revives,"Revives"),v(It(k,"closestToTag"),He.closestToTag,Q.distanceToTag,"Distance to Tag",!1),v(k.logsJoined,He.participation,Q.participation,"Participation"),v(k.dodges,He.dodges,Q.dodging,"Dodging"),v(k.dps,He.dps,Q.dps,"DPS"),v(k.damage,He.damage,Q.damage,"Damage"),n.push({...k,score:S,contribs:K.filter(J=>t(J.name))})}),n.sort((k,S)=>S.score-k.score),n[0]&&n[0].score>0&&(jt=s(n[0])||jt),kn=s(n[1]),Cn=s(n[2]),Sn=n.length>0?n.reduce((k,S)=>k+S.score,0)/n.length:0}const Mi=Object.values(De).sort((e,t)=>{const n=U==="downContribution"?e.downContribution:e.damage;return(U==="downContribution"?t.downContribution:t.damage)-n}).slice(0,25),wi=Object.values(Me).sort((e,t)=>t.damage-e.damage).slice(0,25),vi=e=>{const t=String(e).replace(/^Detailed\s*WvW\s*-\s*/i,"").replace(/^World\s*vs\s*World\s*-\s*/i,"").replace(/^WvW\s*-\s*/i,"").trim(),n=t.match(/^(Red|Blue|Green)\s+(?:Alpine|Desert)?\s*Borderlands$/i);return n?`${n[1]} Borderlands`:t||"Unknown"},Pt=(e,t)=>vi((e==null?void 0:e.zone)||(e==null?void 0:e.mapName)||(e==null?void 0:e.map)||(e==null?void 0:e.location)||(e==null?void 0:e.fightName)||(t==null?void 0:t.fightName)||(t==null?void 0:t.encounterName)||"Unknown"),Ei=(e,t)=>{const n=(t==null?void 0:t.permalink)||(e==null?void 0:e.permalink);if(typeof n=="string"&&n.trim().length>0)return n.trim();const u=e==null?void 0:e.uploadLinks;if(!Array.isArray(u))return"";for(const s of u){if(typeof s=="string"&&s.trim().length>0)return s.trim();if(s&&typeof s=="object"){const k=s.permalink||s.link||s.url||s.reportLink;if(typeof k=="string"&&k.trim().length>0)return k.trim()}}return""},Wt={};_.forEach(e=>{const t=Pt(e==null?void 0:e.details,e);Wt[t]=(Wt[t]||0)+1});const Fi=Object.entries(Wt).map(([e,t])=>{const n=String(e).trim(),u=/eternal battlegrounds|^ebg$/i.test(n);let s="#64748b";return u?s="#ffffff":/red/i.test(n)?s="#ef4444":/blue/i.test(n)?s="#3b82f6":/green/i.test(n)&&(s="#22c55e"),{name:e,value:t,color:s}}).sort((e,t)=>t.value-e.value),{boonTables:Bi}=In(_),Ii=_.map((e,t)=>{var u,s;const n=((u=e.details)==null?void 0:u.players)||[];return{index:t+1,label:`Log ${t+1}`,timestamp:Je(e.details,e),squadCount:n.filter(k=>!k.notInSquad).length,friendlyCount:n.length,enemies:((s=e.details)==null?void 0:s.targets).filter(k=>!k.isFake).length}}).sort((e,t)=>e.timestamp-t.timestamp),Vt={};Array.from(Ae.values()).forEach(e=>{e.profession&&e.profession!=="Unknown"&&(Vt[e.profession]=(Vt[e.profession]||0)+1)});const Pi=Object.entries(Vt).map(([e,t])=>({name:e,value:t,color:en(e)})).sort((e,t)=>t.value-e.value),zt={};Object.keys(Fe).length===0&&_.forEach(e=>{var t,n;(n=(t=e.details)==null?void 0:t.targets)==null||n.forEach(u=>{if(u.isFake)return;const s=u.profession&&u.profession!=="Unknown"?u.profession:u.name||u.id||"Unknown",k=st(s);zt[k]=(zt[k]||0)+1})});const Hi=Object.keys(Fe).length>0?Fe:zt,Ui=Object.entries(Hi).map(([e,t])=>({name:e,value:t,color:en(e)})).sort((e,t)=>t.value-e.value),Li=_.map((e,t)=>({log:e,originalIndex:t})).sort((e,t)=>Je(e.log.details,e.log)-Je(t.log.details,t.log)).map(({log:e},t)=>{const n=e.details;if(!n)return null;const u=n.players||[],s=u.filter(r=>!r.notInSquad),k=u.filter(r=>r.notInSquad),S=n.targets||[],K=S.filter(r=>!r.isFake),v=s.reduce((r,V)=>{var f,C;return r+(((C=(f=V.dpsAll)==null?void 0:f[0])==null?void 0:C.damage)||0)},0),J=s.reduce((r,V)=>{var f,C;return r+(((C=(f=V.defenses)==null?void 0:f[0])==null?void 0:C.damageTaken)||0)},0),{enemyDeaths:ue,enemyDownsDeaths:ne}=Ue(n),w=Be(n),P=Je(n,e),$=Pt(n,e),c={red:0,green:0,blue:0},p=r=>{const V=Number(r);return Number.isFinite(V)?V:0},g=r=>{if(!r||typeof r!="object")return;const V=r.teamID??r.teamId??r.team??r.teamColor??r.team_color;if(V!=null)return V;const f=Object.keys(r).find(C=>/^team/i.test(C));return f?r[f]:void 0},F=(r,V)=>{if(r==null)return null;if(typeof r=="string"){const f=r.toLowerCase();return f.includes("red")?"red":f.includes("green")?"green":f.includes("blue")?"blue":f==="r"?"red":f==="g"?"green":f==="b"?"blue":null}if(typeof r=="number")if(V==="zeroBased"){if(r===0)return"red";if(r===1)return"green";if(r===2)return"blue"}else{if(r===1)return"red";if(r===2)return"green";if(r===3)return"blue"}return null},O=(r,V)=>{const f={};return r.forEach(C=>{const q=V(C),G=st(q);G&&(f[G]=(f[G]||0)+1)}),f},T=O(s,r=>(r==null?void 0:r.profession)||(r==null?void 0:r.name)),B=O(k,r=>(r==null?void 0:r.profession)||(r==null?void 0:r.name)),te=O(K,r=>(r==null?void 0:r.profession)||(r==null?void 0:r.name)||(r==null?void 0:r.id));if(n.teamCounts&&typeof n.teamCounts=="object"){const r=n.teamCounts;c.red=p(r.red??r.r??r[0]??r[1]),c.green=p(r.green??r.g??r[1]??r[2]),c.blue=p(r.blue??r.b??r[2]??r[3])}else{const r=[];S.forEach(q=>{if(q!=null&&q.isFake)return;const G=g(q);G!=null&&r.push(G)}),u.forEach(q=>{if(!(q!=null&&q.notInSquad))return;const G=g(q);G!=null&&r.push(G)}),r.length===0&&u.forEach(q=>{const G=g(q);G!=null&&r.push(G)});const V=new Set;r.forEach(q=>{typeof q=="number"&&V.add(q)});const f=V.has(0)?"zeroBased":V.has(3)?"oneBased":"zeroBased";if(r.forEach(q=>{const G=F(q,f);G&&(c[G]+=1)}),c.red+c.green+c.blue===0&&r.length>0){const q=new Map;r.forEach(y=>{const Ne=String(y);q.set(Ne,(q.get(Ne)||0)+1)});const G=Array.from(q.values()).sort((y,Ne)=>Ne-y);c.red=G[0]||0,c.green=G[1]||0,c.blue=G[2]||0}c.red+c.green+c.blue===0&&(c.red=Math.max(K.length,u.filter(q=>q==null?void 0:q.notInSquad).length))}return{id:e.filePath||`fight-${t}`,label:e.encounterName||`Fight ${t+1}`,permalink:Ei(n,e),timestamp:P,mapName:$,duration:ui(n.durationMS),isWin:w,squadCount:s.length,allyCount:k.length,enemyCount:K.length,teamCounts:c,alliesDown:s.reduce((r,V)=>{var f,C;return r+(((C=(f=V.defenses)==null?void 0:f[0])==null?void 0:C.downCount)||0)},0),alliesDead:s.reduce((r,V)=>{var f,C;return r+(((C=(f=V.defenses)==null?void 0:f[0])==null?void 0:C.deadCount)||0)},0),alliesRevived:s.reduce((r,V)=>{var f,C;return Number(((C=(f=V.statsAll)==null?void 0:f[0])==null?void 0:C.saved)||0)>0?r+1:r},0),rallies:0,enemyDeaths:ue,enemyDowns:Math.max(0,ne-ue),totalOutgoingDamage:v,totalIncomingDamage:J,incomingBarrierAbsorbed:s.reduce((r,V)=>{var f,C;return r+(((C=(f=V.defenses)==null?void 0:f[0])==null?void 0:C.damageBarrier)||0)},0),outgoingBarrierAbsorbed:s.reduce((r,V)=>{var q;const f=(q=V.extBarrierStats)==null?void 0:q.outgoingBarrier;if(!Array.isArray(f))return r;let C=0;return f.forEach(G=>{if(Array.isArray(G)){G.forEach(y=>{C+=Number((y==null?void 0:y.barrier)||0)});return}C+=Number((G==null?void 0:G.barrier)||0)}),r+C},0),squadClassCountsFight:T,allyClassCountsFight:B,enemyClassCounts:te}}).filter(Boolean),$i=(e,t)=>{const n=(t==null?void 0:t.skillMap)||{},u=(t==null?void 0:t.buffMap)||{};let s=0,k="";const S=v=>{const J=Number(v);if(!Number.isFinite(J))return String(v||"Unknown Skill");const ue=(n==null?void 0:n[`s${J}`])||(n==null?void 0:n[`${J}`]);if(ue!=null&&ue.name)return String(ue.name);const ne=(u==null?void 0:u[`b${J}`])||(u==null?void 0:u[`${J}`]);return ne!=null&&ne.name?String(ne.name):`Skill ${J}`},K=v=>{if(!v||typeof v!="object")return;const J=[Number(v.max),Number(v.maxDamage),Number(v.maxHit),Number(v.totalDamage)>0&&Number(v.connectedHits)>0?Number(v.totalDamage)/Number(v.connectedHits):0].filter(ne=>Number.isFinite(ne)),ue=J.length>0?Math.max(...J):0;ue>s&&(s=ue,k=S(v.id))};return Array.isArray(e==null?void 0:e.totalDamageDist)&&e.totalDamageDist.forEach(v=>{Array.isArray(v)&&v.forEach(J=>K(J))}),Array.isArray(e==null?void 0:e.targetDamageDist)&&e.targetDamageDist.forEach(v=>{Array.isArray(v)&&v.forEach(J=>{Array.isArray(J)&&J.forEach(ue=>K(ue))})}),{peak:s,skillName:k||"Unknown Skill"}},xi=(()=>{const e=w=>String(w||"").replace(/^Detailed\s*WvW\s*-\s*/i,"").replace(/^World\s*vs\s*World\s*-\s*/i,"").replace(/^WvW\s*-\s*/i,"").trim(),t=w=>e(w).toLowerCase().split(/[^a-z0-9]+/i).map(P=>P.trim()).filter(Boolean).map(P=>P.length>3&&P.endsWith("s")?P.slice(0,-1):P),n=(w,P)=>{const $=e(w),c=e(P);if(!c)return $;if(!$)return c;const p=t($),g=t(c),F=new Set(p),O=new Set(g),T=g.length>0&&g.every(te=>F.has(te)),B=p.length>0&&p.every(te=>O.has(te));return T||B?$:`${$} - ${c}`},u=[],s=new Map,k=w=>{const P=T=>{if(!Array.isArray(T)||T.length===0)return[];const B=[];for(let te=0;te<T.length;te+=1){const r=Number(T[te]||0),V=te>0?Number(T[te-1]||0):0;B.push(Math.max(0,r-V))}return B},$=T=>{if(!Array.isArray(T))return[];const B=T.reduce((r,V)=>Math.max(r,Array.isArray(V)?V.length:0),0);if(B<=0)return[];const te=new Array(B).fill(0);return T.forEach(r=>{if(Array.isArray(r))for(let V=0;V<B;V+=1)te[V]+=Number(r[V]||0)}),te},c=T=>Array.isArray(T)?T.map(B=>Number(B||0)):null,g=(T=>{if(!Array.isArray(T)||T.length===0)return null;const B=T[0];if(!Array.isArray(B))return null;if(Array.isArray(B[0])&&Array.isArray(B[0][0]))return $(B);if(Array.isArray(B[0])&&!Array.isArray(B[0][0])){const te=T.map(r=>c(Array.isArray(r)?r[0]:null)).filter(r=>Array.isArray(r)&&r.length>0);if(te.length>0)return $(te)}return null})(w==null?void 0:w.targetDamage1S),F=Array.isArray(w==null?void 0:w.damage1S)&&Array.isArray(w.damage1S[0])?w.damage1S[0]:null,O=g||(Array.isArray(F)?F.map(T=>Number(T||0)):[]);return P(O)},S=(w,P)=>{if(!Array.isArray(w)||w.length===0||P<=0)return 0;let $=0,c=0;for(let p=0;p<w.length;p+=1)$+=Number(w[p]||0),p>=P&&($-=Number(w[p-P]||0)),p>=P-1&&$>c&&(c=$);return Math.max(0,c)},K=(w,P)=>{if(!Array.isArray(w)||w.length===0||P<=0)return[];const $=[];for(let c=0;c<w.length;c+=P){const p=Math.min(c+P,w.length),g=w.slice(c,p).reduce((F,O)=>F+Number(O||0),0);$.push(g)}return $},v=w=>Array.isArray(w)?w.map(P=>Array.isArray(P)?[Number(P[0]),Number(P[1])]:P&&typeof P=="object"?[Number(P.time),Number(P.value)]:null).filter(P=>!!P&&Number.isFinite(P[0])&&P[0]>=0):[],J=(w,P,$,c,p)=>{if(!w.length||c<=0)return[];const g=Math.max(c*5e3,p||0),F=C=>C.reduce((q,G)=>G>=0&&G<=g+2e3?q+1:q,0),O=w.map(C=>Number(C||0)).filter(C=>Number.isFinite(C)&&C>=0);if(!O.length)return[];const T=[O],B=O.reduce((C,q)=>Math.max(C,q),0),te=O.reduce((C,q)=>Math.min(C,q),Number.POSITIVE_INFINITY);B>g*20&&T.push(O.map(C=>C/1e3)),B<=g*2&&te>=0&&B>0&&B<Math.max(120,c*5+10)&&T.push(O.map(C=>C*1e3));let r=O,V=0,f=-1;return T.forEach(C=>{const q=C.reduce((y,Ne)=>Math.min(y,Ne),Number.POSITIVE_INFINITY),G=new Set([0,...P,...$]);if(Number.isFinite(q)&&g>0&&q>g){const y=Math.floor(q/g)*g;G.add(y),G.add(Math.max(0,y-g))}G.forEach(y=>{const Ne=C.map(Le=>Le-y),Oe=F(Ne);Oe>f&&(f=Oe,V=y,r=C)})}),r.map(C=>C-V).filter(C=>Number.isFinite(C)&&C>=0)},ue=(w,P,$,c,p)=>{const g=J(w,P,$,c,p);return Array.from(new Set(g.map(F=>Math.floor(F/5e3)).filter(F=>Number.isFinite(F)&&F>=0&&F<c)))};_.map(w=>({log:w,ts:Je(w==null?void 0:w.details,w)})).sort((w,P)=>w.ts-P.ts).forEach(({log:w},P)=>{const $=w==null?void 0:w.details;if(!$)return;const c=e($.fightName||w.fightName||`Fight ${P+1}`),p=Pt($,w),g=n(c,String(p||"")),F={},O=Array.isArray($.players)?$.players:[],T=O.flatMap(f=>{const C=f==null?void 0:f.combatReplayData;return Array.isArray(C)?C.map(q=>Number(q==null?void 0:q.start)):[Number(C==null?void 0:C.start)]}).filter(f=>Number.isFinite(f)&&f>=0);O.forEach(f=>{if(f!=null&&f.notInSquad)return;const C=String((f==null?void 0:f.account)||(f==null?void 0:f.name)||"Unknown"),q=String((f==null?void 0:f.character_name)||(f==null?void 0:f.display_name)||(f==null?void 0:f.name)||""),G=String((f==null?void 0:f.profession)||"Unknown"),y=`${C}|${G}`,Ne=$i(f,$),Oe=Number(Ne.peak||0),Le=k(f),L=Number(S(Le,1)||0),i=Number(S(Le,5)||0),d=Number(S(Le,30)||0),N=Math.max(0,Math.ceil(Number(($==null?void 0:$.durationMS)||0)/5e3)),I=Math.max(0,Math.ceil(Le.length/5)),R=Math.max(N,I),b=K(Le,5),Z=Array.from({length:R},(j,z)=>Number(b[z]||0)),H=(()=>{const j=f==null?void 0:f.combatReplayData;return Array.isArray(j)?j.filter(z=>z&&typeof z=="object"):j&&typeof j=="object"?[j]:[]})(),Y=H.map(j=>Number(j==null?void 0:j.start)).filter(j=>Number.isFinite(j)&&j>=0),me=H.flatMap(j=>v(j==null?void 0:j.down).map(([z])=>Number(z||0))),re=H.flatMap(j=>v(j==null?void 0:j.dead).map(([z])=>Number(z||0)));F[y]={hit:Oe,burst1s:L,burst5s:i,burst30s:d,skillName:Ne.skillName,buckets5s:Z,downIndices5s:ue(me,Y,T,R,Number(($==null?void 0:$.durationMS)||0)),deathIndices5s:ue(re,Y,T,R,Number(($==null?void 0:$.durationMS)||0))};const A=s.get(y)||{key:y,account:C,displayName:C,characterName:q,profession:G,professionList:[G],logs:0,peakHit:0,peak1s:0,peak5s:0,peak30s:0,peakFightLabel:"",peakSkillName:""};A.logs+=1,A.professionList.includes(G)||A.professionList.push(G),!A.characterName&&q&&(A.characterName=q),Oe>A.peakHit&&(A.peakHit=Oe,A.peakFightLabel=g,A.peakSkillName=Ne.skillName),L>A.peak1s&&(A.peak1s=L),i>A.peak5s&&(A.peak5s=i),d>A.peak30s&&(A.peak30s=d),s.set(y,A)});const B=Object.values(F).reduce((f,C)=>Math.max(f,Number((C==null?void 0:C.hit)||0)),0),te=Object.values(F).reduce((f,C)=>Math.max(f,Number((C==null?void 0:C.burst1s)||0)),0),r=Object.values(F).reduce((f,C)=>Math.max(f,Number((C==null?void 0:C.burst5s)||0)),0),V=Object.values(F).reduce((f,C)=>Math.max(f,Number((C==null?void 0:C.burst30s)||0)),0);u.push({id:w.filePath||w.id||`fight-${P+1}`,shortLabel:`F${P+1}`,fullLabel:g,timestamp:Je($,w),values:F,maxHit:B,max1s:te,max5s:r,max30s:V})});const ne=Array.from(s.values()).sort((w,P)=>P.peakHit!==w.peakHit?P.peakHit-w.peakHit:w.displayName.localeCompare(P.displayName));return{fights:u,players:ne}})(),Oi=(()=>{const e=c=>String(c||"").replace(/^Detailed\s*WvW\s*-\s*/i,"").replace(/^World\s*vs\s*World\s*-\s*/i,"").replace(/^WvW\s*-\s*/i,"").trim(),t=c=>e(c).toLowerCase().split(/[^a-z0-9]+/i).map(p=>p.trim()).filter(Boolean).map(p=>p.length>3&&p.endsWith("s")?p.slice(0,-1):p),n=(c,p)=>{const g=e(c),F=e(p);if(!F)return g;if(!g)return F;const O=t(g),T=t(F),B=new Set(O),te=new Set(T),r=T.length>0&&T.every(f=>B.has(f)),V=O.length>0&&O.every(f=>te.has(f));return r||V?g:`${g} - ${F}`},u=[],s=new Map,k=(c,p)=>{const g=Number(c);if(!Number.isFinite(g))return String(c||"Unknown Skill");const F=(p==null?void 0:p.skillMap)||{},O=(p==null?void 0:p.buffMap)||{},T=(F==null?void 0:F[`s${g}`])||(F==null?void 0:F[`${g}`]);if(T!=null&&T.name)return String(T.name);const B=(O==null?void 0:O[`b${g}`])||(O==null?void 0:O[`${g}`]);return B!=null&&B.name?String(B.name):`Skill ${g}`},S=(c,p)=>{let g=0,F="";const O=T=>{if(!T||typeof T!="object"||T.indirectDamage)return;const B=[Number(T.max),Number(T.maxDamage),Number(T.maxHit),Number(T.totalDamage)>0&&Number(T.connectedHits)>0?Number(T.totalDamage)/Number(T.connectedHits):0].filter(r=>Number.isFinite(r)),te=B.length>0?Math.max(...B):0;te>g&&(g=te,F=k(T.id,p))};return Array.isArray(c==null?void 0:c.totalDamageDist)&&c.totalDamageDist.forEach(T=>{Array.isArray(T)&&T.forEach(B=>O(B))}),Array.isArray(c==null?void 0:c.targetDamageDist)&&c.targetDamageDist.forEach(T=>{Array.isArray(T)&&T.forEach(B=>{Array.isArray(B)&&B.forEach(te=>O(te))})}),{peak:g,skillName:F||"Unknown Skill"}},K=c=>{if(!Array.isArray(c)||c.length===0)return[];const p=[];for(let g=0;g<c.length;g+=1){const F=Number(c[g]||0),O=g>0?Number(c[g-1]||0):0;p.push(Math.max(0,F-O))}return p},v=c=>{const p=Array.isArray(c==null?void 0:c.powerDamage1S)&&Array.isArray(c.powerDamage1S[0])?c.powerDamage1S[0].map(g=>Number(g||0)):[];return K(p)},J=(c,p)=>{if(!Array.isArray(c)||c.length===0||p<=0)return 0;let g=0,F=0;for(let O=0;O<c.length;O+=1)g+=Number(c[O]||0),O>=p&&(g-=Number(c[O-p]||0)),O>=p-1&&g>F&&(F=g);return Math.max(0,F)},ue=(c,p)=>{if(!Array.isArray(c)||c.length===0||p<=0)return[];const g=[];for(let F=0;F<c.length;F+=p){const O=Math.min(F+p,c.length),T=c.slice(F,O).reduce((B,te)=>B+Number(te||0),0);g.push(T)}return g},ne=c=>Array.isArray(c)?c.map(p=>Array.isArray(p)?[Number(p[0]),Number(p[1])]:p&&typeof p=="object"?[Number(p.time),Number(p.value)]:null).filter(p=>!!p&&Number.isFinite(p[0])&&p[0]>=0):[],w=(c,p,g,F,O)=>{if(!c.length||F<=0)return[];const T=Math.max(F*5e3,O||0),B=y=>y.reduce((Ne,Oe)=>Oe>=0&&Oe<=T+2e3?Ne+1:Ne,0),te=c.map(y=>Number(y||0)).filter(y=>Number.isFinite(y)&&y>=0);if(!te.length)return[];const r=[te],V=te.reduce((y,Ne)=>Math.max(y,Ne),0),f=te.reduce((y,Ne)=>Math.min(y,Ne),Number.POSITIVE_INFINITY);V>T*20&&r.push(te.map(y=>y/1e3)),V<=T*2&&f>=0&&V>0&&V<Math.max(120,F*5+10)&&r.push(te.map(y=>y*1e3));let C=te,q=0,G=-1;return r.forEach(y=>{const Ne=y.reduce((Le,L)=>Math.min(Le,L),Number.POSITIVE_INFINITY),Oe=new Set([0,...p,...g]);if(Number.isFinite(Ne)&&T>0&&Ne>T){const Le=Math.floor(Ne/T)*T;Oe.add(Le),Oe.add(Math.max(0,Le-T))}Oe.forEach(Le=>{const L=y.map(d=>d-Le),i=B(L);i>G&&(G=i,q=Le,C=y)})}),C.map(y=>y-q).filter(y=>Number.isFinite(y)&&y>=0)},P=(c,p,g,F,O)=>{const T=w(c,p,g,F,O);return Array.from(new Set(T.map(B=>Math.floor(B/5e3)).filter(B=>Number.isFinite(B)&&B>=0&&B<F)))};_.map(c=>({log:c,ts:Je(c==null?void 0:c.details,c)})).sort((c,p)=>c.ts-p.ts).forEach(({log:c},p)=>{const g=c==null?void 0:c.details;if(!g)return;const F=e(g.fightName||c.fightName||`Fight ${p+1}`),O=Pt(g,c),T=n(F,String(O||"")),B={},r=(Array.isArray(g.players)?g.players:[]).filter(L=>!(L!=null&&L.notInSquad)),V=r.flatMap(L=>{const i=L==null?void 0:L.combatReplayData;return Array.isArray(i)?i.map(d=>Number(d==null?void 0:d.start)):[Number(i==null?void 0:i.start)]}).filter(L=>Number.isFinite(L)&&L>=0),f=r.flatMap(L=>{const i=L==null?void 0:L.combatReplayData;return(Array.isArray(i)?i:i?[i]:[]).flatMap(N=>ne(N==null?void 0:N.down).map(([I])=>Number(I||0)))}),C=r.flatMap(L=>{const i=L==null?void 0:L.combatReplayData;return(Array.isArray(i)?i:i?[i]:[]).flatMap(N=>ne(N==null?void 0:N.dead).map(([I])=>Number(I||0)))}),q=new Map;(Array.isArray(g.targets)?g.targets:[]).forEach(L=>{if(!L||L.isFake||!L.enemyPlayer)return;const i=st((L==null?void 0:L.profession)||(L==null?void 0:L.name)||(L==null?void 0:L.id))||"Unknown",d=v(L),N=S(L,g);let I=q.get(i);I||(I={perSecond:[],hit:0,skillName:""},q.set(i,I)),d.length>I.perSecond.length&&(I.perSecond.length=d.length);for(let b=0;b<d.length;b+=1)I.perSecond[b]=Number(I.perSecond[b]||0)+Number(d[b]||0);const R=Number(N.peak||0);R>I.hit&&(I.hit=R,I.skillName=N.skillName||"Unknown Skill")}),q.forEach((L,i)=>{const d=i,N=Number(L.hit||0),I=Number(J(L.perSecond,1)||0),R=Number(J(L.perSecond,5)||0),b=Number(J(L.perSecond,30)||0),Z=Math.max(0,Math.ceil(Number((g==null?void 0:g.durationMS)||0)/5e3)),H=Math.max(0,Math.ceil(L.perSecond.length/5)),Y=Math.max(Z,H),me=ue(L.perSecond,5),re=Array.from({length:Y},(j,z)=>Number(me[z]||0));B[d]={hit:N,burst1s:I,burst5s:R,burst30s:b,skillName:L.skillName||"Unknown Skill",buckets5s:re,downIndices5s:P(f,[],V,Y,Number((g==null?void 0:g.durationMS)||0)),deathIndices5s:P(C,[],V,Y,Number((g==null?void 0:g.durationMS)||0))};const A=s.get(d)||{key:d,account:i,displayName:i,characterName:"",profession:i,professionList:[i],logs:0,peakHit:0,peak1s:0,peak5s:0,peak30s:0,peakFightLabel:"",peakSkillName:""};A.logs+=1,N>A.peakHit&&(A.peakHit=N,A.peakFightLabel=T,A.peakSkillName=L.skillName||"Unknown Skill"),I>A.peak1s&&(A.peak1s=I),R>A.peak5s&&(A.peak5s=R),b>A.peak30s&&(A.peak30s=b),s.set(d,A)});const y=Object.values(B).reduce((L,i)=>Math.max(L,Number((i==null?void 0:i.hit)||0)),0),Ne=Object.values(B).reduce((L,i)=>Math.max(L,Number((i==null?void 0:i.burst1s)||0)),0),Oe=Object.values(B).reduce((L,i)=>Math.max(L,Number((i==null?void 0:i.burst5s)||0)),0),Le=Object.values(B).reduce((L,i)=>Math.max(L,Number((i==null?void 0:i.burst30s)||0)),0);u.push({id:c.filePath||c.id||`fight-${p+1}`,shortLabel:`F${p+1}`,fullLabel:T,timestamp:Je(g,c),values:B,maxHit:y,max1s:Ne,max5s:Oe,max30s:Le})});const $=Array.from(s.values()).sort((c,p)=>p.peakHit!==c.peakHit?p.peakHit-c.peakHit:c.displayName.localeCompare(p.displayName));return{fights:u,players:$}})(),Ri=Array.from(Qe.entries()).map(([e,t])=>{const n=Ze.get(e)||{},u=Array.from(t.values()).map(s=>{var ue;const k=Array.from(s.professions||[]).filter(ne=>ne&&ne!=="Unknown");let S=s.profession||"Unknown";if(k.length>0){S=k[0];let ne=((ue=s.professionTimeMs)==null?void 0:ue[S])||0;k.forEach(w=>{var $;const P=(($=s.professionTimeMs)==null?void 0:$[w])||0;P>ne&&(ne=P,S=w)})}const K=s.durationMs||0,v=s.totalMs/1e3,J=K>0?s.totalMs/K:0;return{account:s.account,profession:S,professionList:k,total:v,perSecond:J,duration:K/1e3}}).filter(s=>s.total>0||s.perSecond>0);return{id:e,name:n.name||e,icon:n.icon,rows:u}}).filter(e=>e.rows.length>0),_i=Array.from(je.values()).map(e=>{const t=Array.from(e.skills.values()).sort((u,s)=>s.damage-u.damage),n=t.reduce((u,s)=>(u[s.id]=s,u),{});return{key:e.key,account:e.account,displayName:e.displayName,profession:e.profession,professionList:e.professionList,totalFightMs:e.totalFightMs,skills:t,skillMap:n}}).sort((e,t)=>e.displayName.localeCompare(t.displayName));return{total:W,wins:pe,losses:E,avgSquadSize:bi,avgEnemies:hi,squadKDR:ki,enemyKDR:Ci,totalSquadKills:Se,totalSquadDeaths:ae,totalEnemyKills:le,totalEnemyDeaths:_e,leaderboards:He,...Ai,outgoingConditionSummary:Object.values(Ie).sort((e,t)=>t.damage-e.damage),incomingConditionSummary:Object.values(xe).sort((e,t)=>t.damage-e.damage),outgoingConditionPlayers:Array.from(Ae.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,conditions:e.outgoingConditions})),incomingConditionPlayers:Array.from(Ae.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,conditions:e.incomingConditions})),topSkills:Mi,topIncomingSkills:wi,playerSkillBreakdowns:_i,topSkillsMetric:U,mapData:Fi,timelineData:Ii,boonTables:Bi,offensePlayers:Array.from(Ae.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,offenseTotals:e.offenseTotals,offenseRateWeights:e.offenseRateWeights,totalFightMs:e.totalFightMs})),defensePlayers:Array.from(Ae.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,defenseTotals:e.defenseTotals,activeMs:e.defenseActiveMs})),damageMitigationPlayers:Si,damageMitigationMinions:Di,supportPlayers:Array.from(Ae.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,supportTotals:e.supportTotals,activeMs:e.supportActiveMs})),healingPlayers:Array.from(Ae.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,healingTotals:e.healingTotals,activeMs:e.healingActiveMs})),mvp:jt,silver:kn,bronze:Cn,squadClassData:Pi,enemyClassData:Ui,fightBreakdown:Li,spikeDamage:xi,incomingStrikeDamage:Oi,specialTables:Ri,topStatsPerSecond:Xe,topStatsLeaderboardsPerSecond:Ye,avgMvpScore:Sn}})(),Ve=(()=>{const Ce=new Map,he=new Map,U=[],W=new Map,pe=new Map;_.forEach(oe=>{const se=oe.details;if(!se)return;const ae=se.skillMap||{},Se=se.fightName||"Log",_e=Je(se,oe)||Date.now(),le={id:oe.filePath||oe.id||Se,label:Se,timestamp:_e,skillEntries:{},playerActiveSeconds:{},durationSeconds:se.durationMS?se.durationMS/1e3:0};(se.players||[]).forEach(Be=>{if(Be.notInSquad)return;const Ae=Be.account||Be.name||"Unknown",qe=Be.profession||"Unknown",De=`${Ae}|${qe}`;let Me=he.get(De);Me||(Me={key:De,account:Ae,displayName:Ae,profession:qe,professionList:[qe],logs:0,totalActiveSeconds:0,skillTotals:{}},he.set(De,Me)),Me.logs++;const je=(Array.isArray(Be.activeTimes)?Be.activeTimes[0]:0)/1e3;Me.totalActiveSeconds=(Me.totalActiveSeconds||0)+je,le.playerActiveSeconds[De]=je,(Be.rotation||[]).forEach(Ie=>{var At,Mt,wt;if(!(Ie!=null&&Ie.id))return;const xe=((At=Ie.skills)==null?void 0:At.length)||0;if(xe<=0)return;const Fe=`s${Ie.id}`,Ze=((Mt=ae[Fe])==null?void 0:Mt.name)||`Skill ${Ie.id}`,Qe=(wt=ae[Fe])==null?void 0:wt.icon;Me.skillTotals[Fe]=(Me.skillTotals[Fe]||0)+xe,Ce.set(Fe,(Ce.get(Fe)||0)+xe),W.set(Fe,Ze),Qe&&!pe.has(Fe)&&pe.set(Fe,Qe),le.skillEntries[Fe]||(le.skillEntries[Fe]={name:Ze,icon:Qe,players:{}}),!le.skillEntries[Fe].icon&&Qe&&(le.skillEntries[Fe].icon=Qe),le.skillEntries[Fe].players[De]=(le.skillEntries[Fe].players[De]||0)+xe})}),U.push(le)});const E=Array.from(Ce.entries()).map(([oe,se])=>({id:oe,name:W.get(oe)||oe,total:se,icon:pe.get(oe)})).sort((oe,se)=>se.total-oe.total);return{logRecords:U,players:Array.from(he.values()),skillOptions:E,resUtilitySkills:[]}})();return{validLogs:_,stats:Re,skillUsageData:Ve}};let ye=null,ut=!1,tn=null,nn=0,on=0,$t=null;const sn=o=>{if(!o||typeof o!="object")return o;const a=(M,x)=>{const _={};return x.forEach(fe=>{M&&Object.prototype.hasOwnProperty.call(M,fe)&&(_[fe]=M[fe])}),_},l=a(o,["players","targets","durationMS","uploadTime","timeStart","timeStartStd","timeEnd","timeEndStd","fightName","success","teamCounts","combatReplayMetaData","skillMap","buffMap","encounterDuration","player_damage_mitigation","player_minion_damage_mitigation","playerDamageMitigation","playerMinionDamageMitigation"]);return Array.isArray(l.players)&&(l.players=l.players.map(M=>a(M,["name","display_name","character_name","profession","elite_spec","group","dpsAll","statsAll","dpsTargets","statsTargets","defenses","support","rotation","extHealingStats","extBarrierStats","squadBuffVolumes","selfBuffs","groupBuffs","squadBuffs","selfBuffsActive","groupBuffsActive","squadBuffsActive","buffUptimes","totalDamageDist","targetDamageDist","damage1S","targetDamage1S","totalDamageTaken","totalDamageTakenDist","minions","combatReplayData","hasCommanderTag","notInSquad","account","activeTimes"]))),Array.isArray(l.targets)&&(l.targets=l.targets.map(M=>a(M,["id","name","isFake","dpsAll","statsAll","defenses","totalHealth","healthPercentBurned","enemyPlayer","totalDamageDist"]))),l},fi=o=>{if(!o||typeof o!="object")return o;const a={...o};return o.details?a.details=sn(o.details):a.details=sn(o),a},an=()=>{if(!ut||!ye)return;ut=!1,nn+=1;const o=$t;$t=null;const a=di(ye);self.postMessage({type:"result",result:a,computeId:nn,logCount:ye.logs.length,token:on,completedAt:Date.now(),flushId:o})},xt=()=>{tn===null&&(tn=setInterval(()=>{an()},5e3))};self.onmessage=o=>{var l,M,x,_;const a=o.data;if((a==null?void 0:a.type)==="reset"){ye={logs:[]},typeof a.token=="number"&&(on=a.token),ut=!0,xt();return}if((a==null?void 0:a.type)==="settings"){ye={logs:(ye==null?void 0:ye.logs)||[],precomputedStats:(l=a.payload)==null?void 0:l.precomputedStats,mvpWeights:(M=a.payload)==null?void 0:M.mvpWeights,statsViewSettings:(x=a.payload)==null?void 0:x.statsViewSettings,disruptionMethod:(_=a.payload)==null?void 0:_.disruptionMethod},ut=!0,xt();return}if((a==null?void 0:a.type)==="log"){ye||(ye={logs:[]}),ye.logs.push(fi(a.payload)),ut=!0,xt();return}(a==null?void 0:a.type)==="flush"&&(typeof a.flushId=="number"&&($t=a.flushId),ut=!0,an())}})();
